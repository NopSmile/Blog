<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>code_snippet</title><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root { --active-file-bg-color: rgba(32, 43, 51, 0.63); --active-file-text-color: white; --bg-color: #fff; --text-color: #333; --side-bar-bg-color: #f5f5f5; --control-text-color: #666; }
html { color: rgb(51, 51, 51); background: rgb(255, 255, 255); text-size-adjust: 100%; text-rendering: optimizeLegibility; font-size: 14px; -webkit-font-smoothing: initial; }
#write { max-width: 960px; padding-top: 2em; padding-left: 60px; padding-right: 60px; min-height: calc(100vh - 6em); -webkit-font-smoothing: antialiased; font-size: 16px; }
.typora-node #write { min-height: calc(100% - 6em); }
pre.md-meta-block { background: rgb(245, 245, 245); padding: 1em; border-radius: 3px; font-size: 14px; }
@media screen and (max-width: 800px) {
  html { font-size: 14px; }
  #write { padding-left: 30px; padding-right: 30px; font-size: 14px; }
}
@media screen and (min-width: 1100px) {
  body, #footer-word-count-info { background: rgb(245, 245, 245); }
  body.pin-outline, .pin-outline #footer-word-count-info, .pin-outline footer { background: rgb(255, 255, 255); }
  #write { max-width: 1000px; padding: 40px 60px; background: rgb(255, 255, 255); margin: 3em auto; border-style: solid; border-color: rgb(221, 221, 221); border-image: initial; border-width: 0px 1px; }
  .pin-outline #write { max-width: 1000px; background: rgb(255, 255, 255); margin: 0px; border: 0px; padding-left: 60px; padding-right: 60px; }
  footer { background-color: transparent; }
}
@media screen and (min-width: 1300px) {
  body.pin-outline, .pin-outline #footer-word-count-info, .pin-outline footer { background: rgb(245, 245, 245); }
  .pin-outline #write { max-width: 1000px; padding: 40px 60px; background: rgb(255, 255, 255); margin: 3em auto; border-style: solid; border-color: rgb(221, 221, 221); border-image: initial; border-width: 0px 1px; }
  .pin-outline footer { background-color: transparent; }
  #footer-word-count-info { background: rgb(245, 245, 245); }
}
html.borderbox *, html.borderbox ::before, html.borderbox ::after { box-sizing: border-box; }
body, dl, dt, dd, ul, ol, li, h1, h2, h3, h4, h5, h6, code, form, fieldset, legend, input, textarea, p, blockquote, th, td, hr, button, article, aside, details, figcaption, figure, footer, header, menu, nav, section { margin: 0px; padding: 0px; }
article, aside, details, figcaption, figure, footer, header, menu, nav, section { display: block; }
audio, canvas, video { display: inline-block; }
body, button, input, select, textarea { font-style: normal; font-variant: normal; font-weight: 300; font-stretch: normal; font-size: 1em; line-height: 1.8; font-family: "PingFang SC", "Lantinghei SC", "Microsoft Yahei", "Hiragino Sans GB", "Microsoft Sans Serif", "WenQuanYi Micro Hei", sans; }
body { font-family: "PingFang SC", "Lantinghei SC", "Microsoft Yahei", "Hiragino Sans GB", "Microsoft Sans Serif", "WenQuanYi Micro Hei", sans; }
h1, h2, h3, h4, h5, h6 { font-family: TimesNewRomanPS-ItalicMT, "PingFang SC", "Lantinghei SC", "Microsoft Yahei", "Hiragino Sans GB", "Microsoft Sans Serif", "WenQuanYi Micro Hei", sans; -webkit-font-smoothing: initial; font-weight: 100; color: var(--text-color); line-height: 1.35; font-variant-numeric: lining-nums; margin-bottom: 1em; }
em { font-family: Georgia-Italic, STSongti-SC-Light, serif; }
strong em, em strong { font-family: Georgia-BoldItalic, STSongti-SC-Regular, serif; }
table { border-collapse: collapse; border-spacing: 0px; }
fieldset, img { border: 0px; }
blockquote { position: relative; color: rgb(153, 153, 153); font-weight: 400; border-left: 1px solid rgb(26, 188, 156); padding-left: 1em; margin: 1em 3em 1em 2em; }
@media only screen and (max-width: 640px) {
  blockquote { margin: 1em 0px; }
}
acronym, abbr { border-bottom: 1px dotted; font-variant: normal; }
abbr { cursor: help; }
address, caption, cite, code, dfn, th, var { font-style: normal; font-weight: 400; }
ul, ol { list-style: none; }
caption, th { text-align: left; }
q::before, q::after { content: ""; }
sub, sup { font-size: 75%; line-height: 0; position: relative; }
:root sub, :root sup { vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
a { color: rgb(26, 188, 156); }
a:hover { text-decoration: underline; }
#write a { border-bottom: 1px solid rgb(26, 188, 156); }
#write a:hover { border-bottom-color: rgb(85, 85, 85); color: rgb(85, 85, 85); text-decoration: none; }
ins, a { text-decoration: none; }
mark { background: rgb(255, 253, 209); border-bottom: 1px solid rgb(255, 237, 206); padding: 2px; margin: 0px 5px; }
pre, code, pre tt { font-family: Courier, "Courier New", monospace; }
#write .md-fences { border: 1px solid rgb(221, 221, 221); padding: 1em 0.5em; display: block; }
hr { border-top: none; border-right: none; border-left: none; border-image: initial; border-bottom: 1px solid rgb(207, 207, 207); margin-bottom: 0.8em; height: 10px; }
#write strong { font-weight: 900; color: rgb(56, 56, 56); }
.code-tooltip.md-hover-tip strong { color: white; }
#write p, #write .md-fences, #write ul, #write ol, #write dl, #write form, #write hr, #write figure, #write-p, #write-pre, #write-ul, #write-ol, #write-dl, #write-form, #write-hr, #write-table, blockquote { margin-bottom: 1.2em; }
html { font-family: "PingFang SC", Verdana, "Helvetica Neue", "Microsoft Yahei", "Hiragino Sans GB", "Microsoft Sans Serif", "WenQuanYi Micro Hei", sans-serif; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write-h1, #write-h2, #write-h3, #write-h4, #write-h5, #write-h6 { margin-top: 1.2em; margin-bottom: 0.6em; line-height: 1.35; color: rgb(0, 0, 0); }
#write h1, #write-h1 { font-size: 2.4em; padding-bottom: 1em; border-bottom: 3px double rgb(238, 238, 238); }
#write h2, #write-h2 { font-size: 1.8em; }
#write h3, #write-h3 { font-size: 1.6em; }
#write h4, #write-h4 { font-size: 1.4em; }
#write h5, #write h6, #write-h5, #write-h6 { font-size: 1.2em; }
#write ul, #write-ul { margin-left: 1.3em; list-style: disc; }
#write ol, #write-ol { list-style: decimal; margin-left: 1.9em; }
#write li ul, #write li ol, #write-ul ul, #write-ul ol, #write-ol ul, #write-ol ol { margin-bottom: 0.8em; margin-left: 2em; }
#write li ul, #write-ul ul, #write-ol ul { list-style: circle; }
#write table th, #write table td { border: 1px solid rgb(221, 221, 221); padding: 0.5em 1em; color: rgb(102, 102, 102); }
#write table .md-table-edit th { border: none; padding: 0px; color: inherit; }
#write table th, #write-table th { background: rgb(251, 251, 251); }
#write table thead th, #write-table thead th { background: rgb(241, 241, 241); }
#write table caption { border-bottom: none; }
#write em { font-weight: inherit; font-style: inherit; }
li > p { margin-bottom: 0px !important; }
#write img { max-width: 100%; }
a.md-toc-inner { border-bottom: 0px !important; }
.md-toc-h1:first-of-type:last-of-type { display: none; }
.md-toc { font-size: inherit; }
.md-toc-h1 .md-toc-inner { font-weight: normal; }
.md-table-edit th { padding: 0px !important; border: 0px !important; }
.mac-seamless-mode #write { min-height: calc((100vh - 6em) - 20px); }
.typora-quick-open-item.active { color: var(--active-file-text-color); }
.in-text-selection, ::selection { background: var(--active-file-bg-color); text-shadow: none; color: white; }
.btn-primary { background-color: rgb(45, 45, 45); border-color: rgb(2, 2, 2); }
.btn-primary:hover, .btn-primary:focus, .btn-primary.focus, .btn-primary:active, .btn-primary.active, .open > .dropdown-toggle.btn-primary { background-color: rgb(78, 76, 78); border: rgb(78, 76, 78); }
#preference-dialog .modal-content { background: rgb(110, 117, 122); --bg-color: #6e757a; --text-color: #f1f1f1; color: rgb(241, 241, 241); }
#typora-source, .typora-sourceview-on { --bg-color: #eee; background: rgb(238, 238, 238); }
.cm-s-typora-default .cm-header, .cm-s-typora-default .cm-property { color: rgb(17, 96, 152); }
.cm-s-typora-default .cm-link { color: rgb(17, 152, 125); }
.cm-s-typora-default .cm-em { font-family: Georgia-Italic, STSongti-SC-Light, serif; color: rgb(111, 100, 0); }
.cm-s-typora-default .cm-em { color: rgb(0, 22, 45); }
.CodeMirror.cm-s-typora-default div.CodeMirror-cursor { border-left: 3px solid rgb(110, 117, 122); }
.cm-s-typora-default .CodeMirror-selectedtext, .typora-sourceview-on .CodeMirror-focused .CodeMirror-selected { background: rgb(110, 117, 122); color: white; }
.file-node-icon.fa.fa-folder::before { color: rgba(32, 43, 51, 0.49); }
#preference-dialog .megamenu-menu-panel h1 { margin-bottom: 1em; }
::-webkit-scrollbar-corner { display: none; background: transparent; }
.cm-s-inner { background-color: rgb(38, 50, 56); color: rgb(233, 237, 237); }
.cm-s-inner .CodeMirror-gutters { background: rgb(38, 50, 56); color: rgb(83, 127, 126); border: none; }
.cm-s-inner .CodeMirror-guttermarker, .cm-s-inner .CodeMirror-guttermarker-subtle, .cm-s-inner .CodeMirror-linenumber { color: rgb(83, 127, 126); }
.cm-s-inner .CodeMirror-cursor { border-left: 1px solid rgb(248, 248, 240); }
.cm-s-inner div.CodeMirror-selected { background: rgba(255, 255, 255, 0.15); }
.cm-s-inner.CodeMirror-focused div.CodeMirror-selected { background: rgba(255, 255, 255, 0.1); }
.cm-s-inner .CodeMirror-line::selection, .cm-s-inner .CodeMirror-line > span::selection, .cm-s-inner .CodeMirror-line > span > span::selection { background: rgba(255, 255, 255, 0.1); }
.cm-s-inner .CodeMirror-activeline-background { background: rgba(0, 0, 0, 0); }
.cm-s-inner .cm-keyword { color: rgb(199, 146, 234); }
.cm-s-inner .cm-operator { color: rgb(233, 237, 237); }
.cm-s-inner .cm-variable-2 { color: rgb(128, 203, 196); }
.cm-s-inner .cm-variable-3 { color: rgb(130, 177, 255); }
.cm-s-inner .cm-builtin { color: rgb(222, 203, 107); }
.cm-s-inner .cm-atom { color: rgb(247, 118, 105); }
.cm-s-inner .cm-number { color: rgb(247, 118, 105); }
.cm-s-inner .cm-def { color: rgb(233, 237, 237); }
.cm-s-inner .cm-string { color: rgb(195, 232, 141); }
.cm-s-inner .cm-string-2 { color: rgb(128, 203, 196); }
.cm-s-inner .cm-comment { color: rgb(84, 110, 122); }
.cm-s-inner .cm-variable { color: rgb(130, 177, 255); }
.cm-s-inner .cm-tag { color: rgb(128, 203, 196); }
.cm-s-inner .cm-meta { color: rgb(128, 203, 196); }
.cm-s-inner .cm-attribute { color: rgb(255, 203, 107); }
.cm-s-inner .cm-property { color: rgb(128, 203, 174); }
.cm-s-inner .cm-qualifier { color: rgb(222, 203, 107); }
.cm-s-inner .cm-variable-3 { color: rgb(222, 203, 107); }
.cm-s-inner .cm-tag { color: rgb(255, 83, 112); }
.cm-s-inner .cm-error { color: rgb(255, 255, 255); background-color: rgb(236, 95, 103); }
.cm-s-inner .CodeMirror-matchingbracket { text-decoration: underline; color: white !important; }
.md-fences { background-color: rgb(38, 50, 56); color: rgb(233, 237, 237); border: none; }
.md-fences .code-tooltip { background-color: rgb(38, 50, 56); }






</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><div class='md-toc' mdtype='toc'><p class="md-toc-content"><span class="md-toc-item md-toc-h2" data-ref="n3"><a class="md-toc-inner" href="#header-n3">[CPP] 读取文件</a></span><span class="md-toc-item md-toc-h2" data-ref="n5"><a class="md-toc-inner" href="#header-n5">[C/CPP] 切分字符串</a></span><span class="md-toc-item md-toc-h3" data-ref="n6"><a class="md-toc-inner" href="#header-n6">利用 std::string 的成员方法实现</a></span><span class="md-toc-item md-toc-h3" data-ref="n12"><a class="md-toc-inner" href="#header-n12">利用 std::stringstream 实现</a></span><span class="md-toc-item md-toc-h3" data-ref="n18"><a class="md-toc-inner" href="#header-n18">利用 strtok/strtok_r 实现</a></span><span class="md-toc-item md-toc-h2" data-ref="n25"><a class="md-toc-inner" href="#header-n25">[CPP] 递增序列/随机序列</a></span><span class="md-toc-item md-toc-h2" data-ref="n38"><a class="md-toc-inner" href="#header-n38">[CPP] 处理信号，服务优雅退出</a></span><span class="md-toc-item md-toc-h2" data-ref="n40"><a class="md-toc-inner" href="#header-n40">[CPP] 自定义服务运行参数</a></span><span class="md-toc-item md-toc-h2" data-ref="n42"><a class="md-toc-inner" href="#header-n42">[CPP] SSL/TLS 客户端</a></span><span class="md-toc-item md-toc-h2" data-ref="n52"><a class="md-toc-inner" href="#header-n52">[CPP] SSL/TLS 服务器端</a></span><span class="md-toc-item md-toc-h2" data-ref="n56"><a class="md-toc-inner" href="#header-n56">[CPP] protobuf 反射</a></span><span class="md-toc-item md-toc-h2" data-ref="n61"><a class="md-toc-inner" href="#header-n61">[CPP] 字符串十六进制转换</a></span><span class="md-toc-item md-toc-h2" data-ref="n67"><a class="md-toc-inner" href="#header-n67">[CPP] find sub vector</a></span><span class="md-toc-item md-toc-h2" data-ref="n73"><a class="md-toc-inner" href="#header-n73">[CPP] 实现 strcpy</a></span><span class="md-toc-item md-toc-h2" data-ref="n75"><a class="md-toc-inner" href="#header-n75">[CPP] 排序算法/快速排序</a></span><span class="md-toc-item md-toc-h2" data-ref="n81"><a class="md-toc-inner" href="#header-n81">[CPP] LRU Cache</a></span><span class="md-toc-item md-toc-h2" data-ref="n87"><a class="md-toc-inner" href="#header-n87">[CPP] SHA256</a></span><span class="md-toc-item md-toc-h2" data-ref="n91"><a class="md-toc-inner" href="#header-n91">[CPP] 自定义结构体排序</a></span><span class="md-toc-item md-toc-h2" data-ref="n96"><a class="md-toc-inner" href="#header-n96">[CPP] 设计模式/代理模式</a></span><span class="md-toc-item md-toc-h2" data-ref="n103"><a class="md-toc-inner" href="#header-n103">[CPP] 策略模式</a></span><span class="md-toc-item md-toc-h2" data-ref="n110"><a class="md-toc-inner" href="#header-n110">[CPP] 设计模式/单例模式</a></span><span class="md-toc-item md-toc-h3" data-ref="n112"><a class="md-toc-inner" href="#header-n112">饿汉式</a></span><span class="md-toc-item md-toc-h3" data-ref="n118"><a class="md-toc-inner" href="#header-n118">饱汉式</a></span><span class="md-toc-item md-toc-h3" data-ref="n124"><a class="md-toc-inner" href="#header-n124">双重检测（线程安全）</a></span><span class="md-toc-item md-toc-h3" data-ref="n130"><a class="md-toc-inner" href="#header-n130">模板</a></span><span class="md-toc-item md-toc-h2" data-ref="n136"><a class="md-toc-inner" href="#header-n136">[CPP] 设计模式/适配器模式</a></span><span class="md-toc-item md-toc-h3" data-ref="n137"><a class="md-toc-inner" href="#header-n137">类适配器</a></span><span class="md-toc-item md-toc-h3" data-ref="n144"><a class="md-toc-inner" href="#header-n144">对象适配器</a></span><span class="md-toc-item md-toc-h2" data-ref="n151"><a class="md-toc-inner" href="#header-n151">[CPP] 设计模式/桥接模式</a></span><span class="md-toc-item md-toc-h2" data-ref="n158"><a class="md-toc-inner" href="#header-n158">[CPP] 设计模式/观察者模式</a></span><span class="md-toc-item md-toc-h2" data-ref="n165"><a class="md-toc-inner" href="#header-n165">[CPP] 设计模式/装饰器模式</a></span><span class="md-toc-item md-toc-h2" data-ref="n172"><a class="md-toc-inner" href="#header-n172">[CPP] 设计模式/职责链模式</a></span><span class="md-toc-item md-toc-h2" data-ref="n179"><a class="md-toc-inner" href="#header-n179">[CPP] 设计模式/模板方法模式</a></span><span class="md-toc-item md-toc-h2" data-ref="n186"><a class="md-toc-inner" href="#header-n186">[CPP] LevelDB 基础使用</a></span><span class="md-toc-item md-toc-h2" data-ref="n188"><a class="md-toc-inner" href="#header-n188">[Python] 输出不换行</a></span><span class="md-toc-item md-toc-h2" data-ref="n194"><a class="md-toc-inner" href="#header-n194">[Python] 获取 unixstamp</a></span><span class="md-toc-item md-toc-h2" data-ref="n198"><a class="md-toc-inner" href="#header-n198">[Python] 日期时间格式化</a></span><span class="md-toc-item md-toc-h2" data-ref="n202"><a class="md-toc-inner" href="#header-n202">[Python] 计算比特币发行总量</a></span><span class="md-toc-item md-toc-h2" data-ref="n206"><a class="md-toc-inner" href="#header-n206">[Python] 简化的工作量证明算法</a></span><span class="md-toc-item md-toc-h2" data-ref="n214"><a class="md-toc-inner" href="#header-n214">[Python] 字串串十六进制转换</a></span><span class="md-toc-item md-toc-h2" data-ref="n221"><a class="md-toc-inner" href="#header-n221">[Python] 列表</a></span><span class="md-toc-item md-toc-h3" data-ref="n222"><a class="md-toc-inner" href="#header-n222">列表的遍历</a></span><span class="md-toc-item md-toc-h3" data-ref="n226"><a class="md-toc-inner" href="#header-n226">列表的去重</a></span><span class="md-toc-item md-toc-h2" data-ref="n230"><a class="md-toc-inner" href="#header-n230">[Python] 集合</a></span><span class="md-toc-item md-toc-h2" data-ref="n234"><a class="md-toc-inner" href="#header-n234">[Python] range 与 xrange</a></span><span class="md-toc-item md-toc-h2" data-ref="n238"><a class="md-toc-inner" href="#header-n238">[Python] 字典的遍历</a></span><span class="md-toc-item md-toc-h2" data-ref="n244"><a class="md-toc-inner" href="#header-n244">[Python] 构造、析构</a></span><span class="md-toc-item md-toc-h2" data-ref="n248"><a class="md-toc-inner" href="#header-n248">[Python] 全局变量</a></span><span class="md-toc-item md-toc-h2" data-ref="n259"><a class="md-toc-inner" href="#header-n259">[Python] lambda 表达式</a></span><span class="md-toc-item md-toc-h2" data-ref="n263"><a class="md-toc-inner" href="#header-n263">[Python] Redis 使用</a></span><span class="md-toc-item md-toc-h2" data-ref="n273"><a class="md-toc-inner" href="#header-n273">[Python] MySQL 使用</a></span><span class="md-toc-item md-toc-h2" data-ref="n281"><a class="md-toc-inner" href="#header-n281">[Python] kafka 使用</a></span><span class="md-toc-item md-toc-h3" data-ref="n290"><a class="md-toc-inner" href="#header-n290">消费者</a></span><span class="md-toc-item md-toc-h3" data-ref="n292"><a class="md-toc-inner" href="#header-n292">生产者</a></span><span class="md-toc-item md-toc-h2" data-ref="n297"><a class="md-toc-inner" href="#header-n297">[Python] YAML 配置文件</a></span><span class="md-toc-item md-toc-h2" data-ref="n305"><a class="md-toc-inner" href="#header-n305">[Python] HTTP GET/POST 请求</a></span><span class="md-toc-item md-toc-h3" data-ref="n306"><a class="md-toc-inner" href="#header-n306">urllib2</a></span><span class="md-toc-item md-toc-h3" data-ref="n310"><a class="md-toc-inner" href="#header-n310">requests</a></span><span class="md-toc-item md-toc-h2" data-ref="n314"><a class="md-toc-inner" href="#header-n314">[Python] Flask RESTful</a></span><span class="md-toc-item md-toc-h2" data-ref="n321"><a class="md-toc-inner" href="#header-n321">[Python] WSGI 服务器以及中间件</a></span><span class="md-toc-item md-toc-h2" data-ref="n330"><a class="md-toc-inner" href="#header-n330">[Python] 微信报警</a></span><span class="md-toc-item md-toc-h2" data-ref="n338"><a class="md-toc-inner" href="#header-n338">[Python] IP 定位</a></span><span class="md-toc-item md-toc-h2" data-ref="n346"><a class="md-toc-inner" href="#header-n346">[Lua] 求最大值</a></span><span class="md-toc-item md-toc-h2" data-ref="n350"><a class="md-toc-inner" href="#header-n350">[Lua] 解包 unpack</a></span><span class="md-toc-item md-toc-h2" data-ref="n354"><a class="md-toc-inner" href="#header-n354">[Lua] 不定参数与格式化</a></span><span class="md-toc-item md-toc-h2" data-ref="n358"><a class="md-toc-inner" href="#header-n358">[Solidity] 以太坊合约示例：hello world</a></span><span class="md-toc-item md-toc-h2" data-ref="n370"><a class="md-toc-inner" href="#header-n370">[Solidity] 以太坊合约示例：存储</a></span><span class="md-toc-item md-toc-h2" data-ref="n379"><a class="md-toc-inner" href="#header-n379">[Solidity] 以太坊合约示例：子货币</a></span><span class="md-toc-item md-toc-h2" data-ref="n412"><a class="md-toc-inner" href="#header-n412">[Solidity] 以太坊合约示例：币安 Token</a></span><span class="md-toc-item md-toc-h2" data-ref="n417"><a class="md-toc-inner" href="#header-n417">[Solidity] 以太坊合约示例：以太坊支付</a></span><span class="md-toc-item md-toc-h2" data-ref="n424"><a class="md-toc-inner" href="#header-n424">[Solidity] 以太坊合约示例：使用非结构化存储实现可升级合约</a></span><span class="md-toc-item md-toc-h2" data-ref="n437"><a class="md-toc-inner" href="#header-n437">[Julia] Hello World</a></span><span class="md-toc-item md-toc-h2" data-ref="n441"><a class="md-toc-inner" href="#header-n441">[Julia] 数学计算</a></span><span class="md-toc-item md-toc-h2" data-ref="n458"><a class="md-toc-inner" href="#header-n458">[Julia] 字符、字符串基础用法</a></span><span class="md-toc-item md-toc-h2" data-ref="n464"><a class="md-toc-inner" href="#header-n464">[Julia] 循环、Map</a></span><span class="md-toc-item md-toc-h2" data-ref="n470"><a class="md-toc-inner" href="#header-n470">[微信小程序] 利用滑块容器实现内容循环滚动</a></span><span class="md-toc-item md-toc-h2" data-ref="n483"><a class="md-toc-inner" href="#header-n483">[微信小程序] 利用全局属性 globalData 跨页面传值</a></span><span class="md-toc-item md-toc-h2" data-ref="n492"><a class="md-toc-inner" href="#header-n492">[微信小程序] 解决 switchTab 不刷新</a></span><span class="md-toc-item md-toc-h2" data-ref="n495"><a class="md-toc-inner" href="#header-n495">[微信小程序] 获取屏幕宽高</a></span><span class="md-toc-item md-toc-h2" data-ref="n504"><a class="md-toc-inner" href="#header-n504">[微信小程序] 模态对话框换行</a></span><span class="md-toc-item md-toc-h2" data-ref="n507"><a class="md-toc-inner" href="#header-n507">[微信小程序] 长按复制</a></span><span class="md-toc-item md-toc-h2" data-ref="n511"><a class="md-toc-inner" href="#header-n511">[微信小程序] 分页加载</a></span><span class="md-toc-item md-toc-h2" data-ref="n522"><a class="md-toc-inner" href="#header-n522">[js] 判断字符串为空</a></span><span class="md-toc-item md-toc-h2" data-ref="n526"><a class="md-toc-inner" href="#header-n526">[js] 以太坊导出私钥</a></span></p></div><hr /><h2><a name='header-n3' class='md-header-anchor '></a>[CPP] 读取文件</h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">bool</span> <span class="cm-def">ReadFile</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">file</span>, <span class="cm-variable">std::string</span> <span class="cm-operator">&amp;</span><span class="cm-variable">out</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::ifstream</span> <span class="cm-variable">fin</span>(<span class="cm-variable">file</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">fin</span>.<span class="cm-variable">is_open</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::stringstream</span> <span class="cm-variable">buffer</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">buffer</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">fin</span>.<span class="cm-variable">rdbuf</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">out</span>.<span class="cm-variable">assign</span>(<span class="cm-variable">buffer</span>.<span class="cm-variable">str</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">fin</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><h2><a name='header-n5' class='md-header-anchor '></a>[C/CPP] 切分字符串</h2><h3><a name='header-n6' class='md-header-anchor '></a>利用 std::string 的成员方法实现</h3><blockquote><p>根据指定的分割字符串切分目标字符串，支持忽略空字符串、去除前后空白字符</p></blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="cpp" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="cpp"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;string&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;iostream&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;vector&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">std::vector</span><span class="cm-operator">&lt;</span><span class="cm-variable">std::string</span><span class="cm-operator">&gt;</span> <span class="cm-def">Split</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable">std::string</span> <span class="cm-operator">&amp;</span><span class="cm-variable">str</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable">std::string</span> <span class="cm-operator">&amp;</span><span class="cm-variable">delimiter</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable-3">bool</span> <span class="cm-variable">allow_empty</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable-3">bool</span> <span class="cm-variable">trim_whitespaces</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 切分字符串</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::vector</span><span class="cm-operator">&lt;</span><span class="cm-variable">std::string</span><span class="cm-operator">&gt;</span> <span class="cm-variable">vec</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">delimiter</span>.<span class="cm-variable">empty</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">vec</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::size_t</span> <span class="cm-variable">current</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::size_t</span> <span class="cm-variable">index</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> ((<span class="cm-variable">index</span> <span class="cm-operator">=</span> <span class="cm-variable">str</span>.<span class="cm-variable">find</span>(<span class="cm-variable">delimiter</span>, <span class="cm-variable">current</span>)) <span class="cm-operator">!=</span> <span class="cm-variable">str</span>.<span class="cm-variable">npos</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">index</span> <span class="cm-operator">-</span> <span class="cm-variable">current</span> <span class="cm-operator">!=</span> <span class="cm-number">0</span> <span class="cm-operator">||</span> <span class="cm-variable">allow_empty</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">vec</span>.<span class="cm-variable">emplace_back</span>(<span class="cm-variable">str</span>.<span class="cm-variable">substr</span>(<span class="cm-variable">current</span>, <span class="cm-variable">index</span> <span class="cm-operator">-</span> <span class="cm-variable">current</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">current</span> <span class="cm-operator">=</span> <span class="cm-variable">index</span> <span class="cm-operator">+</span> <span class="cm-variable">delimiter</span>.<span class="cm-variable">length</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">current</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">str</span>.<span class="cm-variable">length</span>() <span class="cm-operator">||</span> <span class="cm-variable">allow_empty</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">vec</span>.<span class="cm-variable">emplace_back</span>(<span class="cm-variable">str</span>.<span class="cm-variable">substr</span>(<span class="cm-variable">current</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">trim_whitespaces</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">vec</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 去除前后空白字符</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::string</span> <span class="cm-variable">raw</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::size_t</span> <span class="cm-variable">beg</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::size_t</span> <span class="cm-variable">end</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::vector</span><span class="cm-operator">&lt;</span><span class="cm-variable">std::string</span><span class="cm-operator">&gt;</span> <span class="cm-variable">vec2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-keyword">auto</span> <span class="cm-variable">v</span> : <span class="cm-variable">vec</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> ((<span class="cm-variable">beg</span> <span class="cm-operator">=</span> <span class="cm-variable">v</span>.<span class="cm-variable">find_first_not_of</span>(<span class="cm-string">" \t\f\v\n\r"</span>)) <span class="cm-operator">!=</span> <span class="cm-variable">raw</span>.<span class="cm-variable">npos</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">&amp;&amp;</span> (<span class="cm-variable">end</span> <span class="cm-operator">=</span> <span class="cm-variable">v</span>.<span class="cm-variable">find_last_not_of</span>(<span class="cm-string">" \t\f\v\n\r"</span>), <span class="cm-variable">beg</span>) <span class="cm-operator">!=</span> <span class="cm-variable">raw</span>.<span class="cm-variable">npos</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">vec2</span>.<span class="cm-variable">push_back</span>(<span class="cm-variable">v</span>.<span class="cm-variable">substr</span>(<span class="cm-variable">beg</span>, <span class="cm-variable">end</span> <span class="cm-operator">-</span> <span class="cm-variable">beg</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">vec2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::string</span> <span class="cm-variable">target</span> <span class="cm-operator">=</span> <span class="cm-string">"hello, world &nbsp; , a b c  , &nbsp; ,,kevin's blog ,"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::vector</span><span class="cm-operator">&lt;</span><span class="cm-variable">std::string</span><span class="cm-operator">&gt;</span> <span class="cm-variable">result</span> <span class="cm-operator">=</span> <span class="cm-variable">Split</span>(<span class="cm-variable">target</span>, <span class="cm-string">","</span>, <span class="cm-atom">false</span>, <span class="cm-atom">true</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-keyword">auto</span> <span class="cm-variable">v</span> : <span class="cm-variable">result</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">v</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">std::endl</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1452px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1452px;"></div></div></div></pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="basic"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="basic"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">hello</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">world</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">a</span> <span class="cm-variable">b</span> <span class="cm-variable">c</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">kevin</span><span class="cm-comment">'s blog</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><h3><a name='header-n12' class='md-header-anchor '></a>利用 std::stringstream 实现</h3><blockquote><p><strong>限制：</strong>分隔符为一个或多个空格</p></blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="cpp" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="cpp"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;sstream&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;string&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;iostream&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::string</span> <span class="cm-variable">input</span> <span class="cm-operator">=</span> <span class="cm-string">"hello  glad to  see you  "</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::stringstream</span> <span class="cm-variable">ss</span>(<span class="cm-variable">input</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::string</span> <span class="cm-variable">str</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">ss</span> <span class="cm-operator">&gt;&gt;</span> <span class="cm-variable">str</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">str</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">std::endl</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 374px;"></div><div class="CodeMirror-gutters" style="display: none; height: 374px;"></div></div></div></pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="basic"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="basic"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">hello</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">glad</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">to</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">see</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">you</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><h3><a name='header-n18' class='md-header-anchor '></a>利用 strtok/strtok_r 实现</h3><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/split.c'>split.c</a></p><p><strong>是否线程安全：</strong>strtok 在提取字符串时使用了静态缓冲区，非线程安全；strtok_r 线程安全</p></blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;stdio.h&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;string.h&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// char *strtok(char *str, const char *delim);</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// char *strtok_r(char *str, const char *delim, char **saveptr);</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">Split</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">str</span>[] <span class="cm-operator">=</span> <span class="cm-string">"1, hello, world"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">ptr</span> <span class="cm-operator">=</span> <span class="cm-variable">strtok</span>(<span class="cm-variable">str</span>, <span class="cm-string">","</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">ptr</span> <span class="cm-operator">!=</span> <span class="cm-variable">NULL</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">printf</span>(<span class="cm-string">"%s\n"</span>, <span class="cm-variable">ptr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ptr</span> <span class="cm-operator">=</span> <span class="cm-variable">strtok</span>(<span class="cm-variable">NULL</span>, <span class="cm-string">","</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">Split2</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">str</span>[] <span class="cm-operator">=</span> <span class="cm-string">"2, hello, world"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">buf</span> <span class="cm-operator">=</span> <span class="cm-variable">NULL</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">ptr</span> <span class="cm-operator">=</span> <span class="cm-variable">strtok_r</span>(<span class="cm-variable">str</span>, <span class="cm-string">","</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">buf</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">ptr</span> <span class="cm-operator">!=</span> <span class="cm-variable">NULL</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">printf</span>(<span class="cm-string">"%s\n"</span>, <span class="cm-variable">ptr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ptr</span> <span class="cm-operator">=</span> <span class="cm-variable">strtok_r</span>(<span class="cm-variable">NULL</span>, <span class="cm-string">","</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">buf</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Split</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Split2</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 836px;"></div><div class="CodeMirror-gutters" style="display: none; height: 836px;"></div></div></div></pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="bash"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> hello</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> world</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> hello</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> world</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><h2><a name='header-n25' class='md-header-anchor '></a>[CPP] 递增序列/随机序列</h2><ul><li>利用 std::itoa 实现 list/vector 自增序列</li><li>利用 std::shuffle 实现随机序列</li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="cpp" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="cpp"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;algorithm&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;iostream&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;list&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;numeric&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;random&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;vector&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::vector</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span> <span class="cm-variable">vec</span>(<span class="cm-number">10</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::iota</span>(<span class="cm-variable">vec</span>.<span class="cm-variable">begin</span>(), <span class="cm-variable">vec</span>.<span class="cm-variable">end</span>(), <span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"Contents of the vector: "</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-keyword">auto</span> <span class="cm-variable">n</span> : <span class="cm-variable">vec</span>) <span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">n</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">' '</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">'\n'</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::list</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span> <span class="cm-variable">l</span>(<span class="cm-number">10</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::iota</span>(<span class="cm-variable">l</span>.<span class="cm-variable">begin</span>(), <span class="cm-variable">l</span>.<span class="cm-variable">end</span>(), <span class="cm-operator">-</span><span class="cm-number">4</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::vector</span><span class="cm-operator">&lt;</span><span class="cm-variable">std::list</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span>::<span class="cm-variable">iterator</span><span class="cm-operator">&gt;</span> <span class="cm-variable">v</span>(<span class="cm-variable">l</span>.<span class="cm-variable">size</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::iota</span>(<span class="cm-variable">v</span>.<span class="cm-variable">begin</span>(), <span class="cm-variable">v</span>.<span class="cm-variable">end</span>(), <span class="cm-variable">l</span>.<span class="cm-variable">begin</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::shuffle</span>(<span class="cm-variable">v</span>.<span class="cm-variable">begin</span>(), <span class="cm-variable">v</span>.<span class="cm-variable">end</span>(), <span class="cm-variable">std::mt19937</span>{ <span class="cm-variable">std::random_device</span>{}() });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"Contents of the list: "</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-keyword">auto</span> <span class="cm-variable">n</span> : <span class="cm-variable">l</span>) <span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">n</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">' '</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">'\n'</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"Contents of the list, shuffled: "</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-keyword">auto</span> <span class="cm-variable">i</span> : <span class="cm-variable">v</span>) <span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-operator">*</span><span class="cm-variable">i</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">' '</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">'\n'</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 726px;"></div><div class="CodeMirror-gutters" style="display: none; height: 726px;"></div></div></div></pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n33" mdtype="fences">Contents of the vector: 1 2 3 4 5 6 7 8 9 10
Contents of the list: -4 -3 -2 -1 0 1 2 3 4 5
Contents of the list, shuffled: -3 3 5 1 4 0 -2 2 -4 -1
</pre><ul><li>std::itoa 模拟实现</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n37" mdtype="fences">template&lt;class ForwardIterator, class T&gt;
void iota(ForwardIterator first, ForwardIterator last, T value)
{
    while (first != last)
    {
        *first++ = value;
        ++value;
    }
}
</pre><h2><a name='header-n38' class='md-header-anchor '></a>[CPP] 处理信号，服务优雅退出</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="c++" contenteditable="false" cid="n39" mdtype="fences" style="break-inside: unset;">#include &lt;chrono&gt;

#include &lt;signal.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/wait.h&gt;

static bool g_done = false;

static void SignalHandler(int)
{
    std::cout &lt;&lt; "[WARN] try to stop and exit" &lt;&lt; std::endl;
    g_done = true;
}

static void RegisterSignalHandler(void)
{
    struct sigaction action;

    action.sa_handler = SignalHandler;
    sigemptyset(&amp;action.sa_mask);

    // Handle signals properly before shutting down the server.
    // Ctrl + C
    sigaction(SIGINT, &amp;action, (struct sigaction *)nullptr);
    // kill PID
    sigaction(SIGTERM, &amp;action, (struct sigaction *)nullptr);
}

int main(int argc, char **argv)
{
    RegisterSignalHandler();

    // start service

    while (!g_done)
    {
        std::this_thread::sleep_for(std::chrono::seconds(1));
    }

    // stop service

    return 0;
}
</pre><h2><a name='header-n40' class='md-header-anchor '></a>[CPP] 自定义服务运行参数</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="c++" contenteditable="false" cid="n41" mdtype="fences" style="break-inside: unset;">static void ShowHelp()
{
    const char *help =
        "=============================================\n"
        " Desc: Danbay's Access Service\n"
        "\n"
        " Usage:\n"
        "  -c/--conf &lt;file&gt;     default 'default.conf'\n"
        "  -d/--daemon          run in daemon mode\n"
        "  -w/--watchdog        run with watchdog\n"
        "  -h/--help            show help and exit\n"
        "=============================================\n";

    std::cout &lt;&lt; help &lt;&lt; std::endl;
}

int main(int argc, char **argv)
{
    const char *conf = "default.conf";
    bool daemon_alias = false;
    bool watchdog = false;

    const struct option options[] = {
        {"conf", 1, nullptr, 'c'},
        {"daemon", 0, nullptr, 'd'},
        {"watchdog", 0, nullptr, 'w'},
        {"help", 0, nullptr, 'h'}
    };

    int opt = -1;
    while ((opt = getopt_long(argc, argv, "c:dwh", options, nullptr)) != -1)
    {
        switch (opt)
        {
            case 'c':
                conf = optarg;
                break;
            case 'd':
                daemon_alias = true;
                break;
            case 'w':
                watchdog = true;
                break;
            case 'h':
            default:
                ShowHelp();
                return -1;
        }
    }

    // RegisterSignalHandler();

    std::string config;
    if (!ReadFile(conf, config))
    {
        std::cerr &lt;&lt; "[ERROR] open conf file failed" &lt;&lt; std::endl;
        return -1;
    }

    std::cout &lt;&lt; "[INFO] here is all configuration information" &lt;&lt;
        std::endl &lt;&lt; config &lt;&lt; std::endl;

    int ret = 0;
    if (daemon_alias)
    {
        int nochdir = 1;
        int noclose = 0;
        ret = daemon(nochdir, noclose);
        if (ret == -1)
        {
            std::cerr &lt;&lt; "[ERROR] run in daemon mode failed" &lt;&lt; std::endl;
            return -1;
        }
    }

    while (watchdog)
    {
        ret = fork();
        if (ret == -1)
        {
            std::cerr &lt;&lt; "[ERROR] run with watchdog failed" &lt;&lt; std::endl;
            return -1;
        }
        else if (ret == 0)
        {
            break;
        }

        if (wait(&amp;ret) == -1)
        {
            std::cerr &lt;&lt; "[ERROR] run with watchdog failed" &lt;&lt; std::endl;
            return -1;
        }
    }

    // ...
}
</pre><h2><a name='header-n42' class='md-header-anchor '></a>[CPP] SSL/TLS 客户端</h2><blockquote><p><strong>源码路径：</strong></p><ol start='' ><li><a href='https://dudebing99.github.io/Blog/archives/code_snippet/openssl_client.c'>openssl_client.c</a></li><li><a href='https://dudebing99.github.io/Blog/archives/code_snippet/boost_ssl_client.cpp'>boost_ssl_client.cpp</a></li></ol></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="c" contenteditable="false" cid="n50" mdtype="fences" style="break-inside: unset;">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;resolv.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;arpa/inet.h&gt;
#include &lt;unistd.h&gt;
#include &lt;openssl/ssl.h&gt;
#include &lt;openssl/err.h&gt;

#define MAXBUF 1024

#define CA_FILE             "ca.pem"
#define CLIENT_KEY          "client.pem"
#define CLIENT_CERT         "client.pem"

void ShowCerts(SSL * ssl)
{
    X509 *cert;
    char *line;
    cert = SSL_get_peer_certificate(ssl);
    if (cert != NULL)
    {
        line = X509_NAME_oneline(X509_get_subject_name(cert), 0, 0);
        printf("证书: %s\n", line);
        free(line);
        line = X509_NAME_oneline(X509_get_issuer_name(cert), 0, 0);
        printf("颁发者: %s\n", line);
        free(line);
        X509_free(cert);
    }
    else
    {
        printf("无证书信息！\n");
    }
}

int main(int argc, char **argv)
{
    int sockfd, len;
    struct sockaddr_in dest;
    char buffer[MAXBUF + 1];
    SSL_CTX *ctx;
    SSL *ssl;
    const SSL_METHOD *method;

    if (argc != 3)
    {
        printf("%s &lt;ip&gt; &lt;port&gt;\n", argv[0]);
        exit(0);
    }

    SSL_library_init();
    SSL_load_error_strings();
    OpenSSL_add_all_algorithms();
    method = TLSv1_2_client_method();
    ctx = SSL_CTX_new(method);

    if (!ctx)
    {
        printf("create ctx is failed.\n");
    }

    /* 设置会话的握手方式 */
    SSL_CTX_set_verify(ctx, SSL_VERIFY_PEER | SSL_VERIFY_FAIL_IF_NO_PEER_CERT, 0);

    /* 加载 CA FILE */
    if (SSL_CTX_load_verify_locations(ctx, CA_FILE, 0) != 1)
    {
        SSL_CTX_free(ctx);
        printf("Failed to load CA file %s", CA_FILE);
    }

    if (SSL_CTX_set_default_verify_paths(ctx) != 1)
    {
        SSL_CTX_free(ctx);
        printf("Call to SSL_CTX_set_default_verify_paths failed");
    }

    /* 加载客户端证书 */
    if (SSL_CTX_use_certificate_file(ctx, CLIENT_CERT, SSL_FILETYPE_PEM) != 1)
    {
        SSL_CTX_free(ctx);
        printf("Failed to load client certificate from %s", CLIENT_KEY);
    }

    /* 加载客户端私钥 */
    if (SSL_CTX_use_PrivateKey_file(ctx, CLIENT_KEY, SSL_FILETYPE_PEM) != 1)
    {
        SSL_CTX_free(ctx);
        printf("Failed to load client private key from %s", CLIENT_KEY);
    }

    /* 验证私钥 */
    if (SSL_CTX_check_private_key(ctx) != 1)
    {
        SSL_CTX_free(ctx);
        printf("SSL_CTX_check_private_key failed");
    }

    /* 处理握手多次 */
    SSL_CTX_set_mode(ctx, SSL_MODE_AUTO_RETRY);

    if ((sockfd = socket(AF_INET, SOCK_STREAM, 0)) &lt; 0)
    {
        perror("Create socket error.\n");
        exit(errno);
    }

    bzero(&amp;dest, sizeof(dest));
    dest.sin_family = AF_INET;
    dest.sin_port = htons(atoi(argv[2]));
    if (inet_aton(argv[1], (struct in_addr *)&amp;dest.sin_addr.s_addr) == 0)
    {
        perror(argv[1]);
        exit(errno);
    }

    if (connect(sockfd, (struct sockaddr *)&amp;dest, sizeof(dest)) != 0)
    {
        perror("Connect error.\n");
        exit(errno);
    }

    /* 创建 SSL */
    ssl = SSL_new(ctx);
    if (ssl == NULL)
    {
        printf("SSL_new error.\n");
    }

    /* 将 fd 添加到 ssl 层 */
    SSL_set_fd(ssl, sockfd);
    if (SSL_connect(ssl) == -1)
    {
        printf("SSL_connect fail.\n");
        ERR_print_errors_fp(stderr);
    }
    else
    {
        printf("SSL 最终协商的算法：%s\n", SSL_get_cipher(ssl));
        ShowCerts(ssl);
    }

    bzero(buffer, MAXBUF + 1);
    strcpy(buffer, "Hello World!");
    len = SSL_write(ssl, buffer, strlen(buffer));
    if (len &lt; 0)
    {
        printf("消息'%s'发送失败，错误码：%d，错误信息：'%s'\n",
            buffer, errno, strerror(errno));
        goto finish;
    }
    else
    {
        printf("消息'%s'发送成功，长度：%d 字节\n", buffer, len);
    }

    bzero(buffer, MAXBUF + 1);
    len = SSL_read(ssl, buffer, MAXBUF);
    if (len &gt; 0)
    {
        printf("接收消息成功: '%s'，长度：%d\n", buffer, len);
    }
    else
    {
        printf("接收消息失败，错误码：%d，错误信息：'%s'\n",
            errno, strerror(errno));
    }

finish:

    SSL_shutdown(ssl);
    SSL_free(ssl);
    close(sockfd);
    SSL_CTX_free(ctx);

    return 0;
}
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n51" mdtype="fences" style="break-inside: unset;">#include &lt;cstdlib&gt;
#include &lt;iostream&gt;
#include &lt;boost/bind.hpp&gt;
#include &lt;boost/asio.hpp&gt;
#include &lt;boost/asio/ssl.hpp&gt;

enum { max_length = 1024 };

class client
{
public:
  client(boost::asio::io_service&amp; io_service,
      boost::asio::ssl::context&amp; context,
      boost::asio::ip::tcp::resolver::iterator endpoint_iterator)
    : socket_(io_service, context)
  {
    socket_.set_verify_mode(boost::asio::ssl::verify_peer);
    socket_.set_verify_callback(
        boost::bind(&amp;client::verify_certificate, this, _1, _2));

    boost::asio::async_connect(socket_.lowest_layer(), endpoint_iterator,
        boost::bind(&amp;client::handle_connect, this,
          boost::asio::placeholders::error));
  }

  bool verify_certificate(bool preverified,
      boost::asio::ssl::verify_context&amp; ctx)
  {
    // The verify callback can be used to check whether the certificate that is
    // being presented is valid for the peer. For example, RFC 2818 describes
    // the steps involved in doing this for HTTPS. Consult the OpenSSL
    // documentation for more details. Note that the callback is called once
    // for each certificate in the certificate chain, starting from the root
    // certificate authority.

    // In this example we will simply print the certificate's subject name.
    char subject_name[256];
    X509* cert = X509_STORE_CTX_get_current_cert(ctx.native_handle());
    X509_NAME_oneline(X509_get_subject_name(cert), subject_name, 256);
    std::cout &lt;&lt; "Verifying " &lt;&lt; subject_name &lt;&lt; "\n";

    return preverified;
  }

  void handle_connect(const boost::system::error_code&amp; error)
  {
    if (!error)
    {
      socket_.async_handshake(boost::asio::ssl::stream_base::client,
          boost::bind(&amp;client::handle_handshake, this,
            boost::asio::placeholders::error));
    }
    else
    {
      std::cout &lt;&lt; "Connect failed: " &lt;&lt; error.message() &lt;&lt; "\n";
    }
  }

  void handle_handshake(const boost::system::error_code&amp; error)
  {
    if (!error)
    {
      std::cout &lt;&lt; "Enter message: ";
      std::cin.getline(request_, max_length);
      size_t request_length = strlen(request_);

      boost::asio::async_write(socket_,
          boost::asio::buffer(request_, request_length),
          boost::bind(&amp;client::handle_write, this,
            boost::asio::placeholders::error,
            boost::asio::placeholders::bytes_transferred));
    }
    else
    {
      std::cout &lt;&lt; "Handshake failed: " &lt;&lt; error.message() &lt;&lt; "\n";
    }
  }

  void handle_write(const boost::system::error_code&amp; error,
      size_t bytes_transferred)
  {
    if (!error)
    {
      boost::asio::async_read(socket_,
          boost::asio::buffer(reply_, bytes_transferred),
          boost::bind(&amp;client::handle_read, this,
            boost::asio::placeholders::error,
            boost::asio::placeholders::bytes_transferred));
    }
    else
    {
      std::cout &lt;&lt; "Write failed: " &lt;&lt; error.message() &lt;&lt; "\n";
    }
  }

  void handle_read(const boost::system::error_code&amp; error,
      size_t bytes_transferred)
  {
    if (!error)
    {
      std::cout &lt;&lt; "Reply: ";
      std::cout.write(reply_, bytes_transferred);
      std::cout &lt;&lt; "\n";
    }
    else
    {
      std::cout &lt;&lt; "Read failed: " &lt;&lt; error.message() &lt;&lt; "\n";
    }
  }

private:
  boost::asio::ssl::stream&lt;boost::asio::ip::tcp::socket&gt; socket_;
  char request_[max_length];
  char reply_[max_length];
};

std::string get_password()
{
    return "Danbay666!";
}

int main(int argc, char* argv[])
{
  try
  {
    if (argc != 3)
    {
      std::cerr &lt;&lt; "Usage: client &lt;host&gt; &lt;port&gt;\n";
      return 1;
    }

    boost::asio::io_service io_service;

    boost::asio::ip::tcp::resolver resolver(io_service);
    boost::asio::ip::tcp::resolver::query query(argv[1], argv[2]);
    boost::asio::ip::tcp::resolver::iterator iterator = resolver.resolve(query);

    boost::asio::ssl::context ctx(boost::asio::ssl::context::sslv23);
    ctx.set_password_callback(boost::bind(&amp;get_password));
    ctx.use_certificate_chain_file("client.pem");
    ctx.use_private_key_file("client.pem", boost::asio::ssl::context::pem);
    ctx.load_verify_file("ca.pem");

    client c(io_service, ctx, iterator);

    io_service.run();
  }
  catch (std::exception&amp; e)
  {
    std::cerr &lt;&lt; "Exception: " &lt;&lt; e.what() &lt;&lt; "\n";
  }

  return 0;
}
</pre><h2><a name='header-n52' class='md-header-anchor '></a>[CPP] SSL/TLS 服务器端</h2><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/boost_ssl_server.cpp'>boost_ssl_server.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n55" mdtype="fences" style="break-inside: unset;">#include &lt;cstdlib&gt;
#include &lt;iostream&gt;
#include &lt;boost/bind.hpp&gt;
#include &lt;boost/asio.hpp&gt;
#include &lt;boost/asio/ssl.hpp&gt;

typedef boost::asio::ssl::stream&lt;boost::asio::ip::tcp::socket&gt; ssl_socket;

class session
{
public:
  session(boost::asio::io_service&amp; io_service,
      boost::asio::ssl::context&amp; context)
    : socket_(io_service, context)
  {
  }

  ssl_socket::lowest_layer_type&amp; socket()
  {
    return socket_.lowest_layer();
  }

  void start()
  {
    socket_.async_handshake(boost::asio::ssl::stream_base::server,
        boost::bind(&amp;session::handle_handshake, this,
          boost::asio::placeholders::error));
  }

  void handle_handshake(const boost::system::error_code&amp; error)
  {
    if (!error)
    {
      socket_.async_read_some(boost::asio::buffer(data_, max_length),
          boost::bind(&amp;session::handle_read, this,
            boost::asio::placeholders::error,
            boost::asio::placeholders::bytes_transferred));
    }
    else
    {
      delete this;
    }
  }

  void handle_read(const boost::system::error_code&amp; error,
      size_t bytes_transferred)
  {
    if (!error)
    {
      boost::asio::async_write(socket_,
          boost::asio::buffer(data_, bytes_transferred),
          boost::bind(&amp;session::handle_write, this,
            boost::asio::placeholders::error));
    }
    else
    {
      delete this;
    }
  }

  void handle_write(const boost::system::error_code&amp; error)
  {
    if (!error)
    {
      socket_.async_read_some(boost::asio::buffer(data_, max_length),
          boost::bind(&amp;session::handle_read, this,
            boost::asio::placeholders::error,
            boost::asio::placeholders::bytes_transferred));
    }
    else
    {
      delete this;
    }
  }

private:
  ssl_socket socket_;
  enum { max_length = 1024 };
  char data_[max_length];
};

class server
{
public:
  server(boost::asio::io_service&amp; io_service, unsigned short port)
    : io_service_(io_service),
      acceptor_(io_service,
          boost::asio::ip::tcp::endpoint(boost::asio::ip::tcp::v4(), port)),
      context_(boost::asio::ssl::context::sslv23)
  {
    context_.set_options(
        boost::asio::ssl::context::default_workarounds
        | boost::asio::ssl::context::no_sslv2
        | boost::asio::ssl::context::single_dh_use);
    context_.set_password_callback(boost::bind(&amp;server::get_password, this));
    context_.set_verify_callback(boost::bind(&amp;server::verify_certificate, this, _1, _2));
    context_.use_certificate_chain_file("server.pem");
    context_.use_private_key_file("server.pem", boost::asio::ssl::context::pem);
    context_.load_verify_file("ca.pem");
    context_.set_verify_mode(boost::asio::ssl::verify_peer);

    start_accept();
  }

  bool verify_certificate(bool preverified,
      boost::asio::ssl::verify_context&amp; ctx)
  {
    // The verify callback can be used to check whether the certificate that is
    // being presented is valid for the peer. For example, RFC 2818 describes
    // the steps involved in doing this for HTTPS. Consult the OpenSSL
    // documentation for more details. Note that the callback is called once
    // for each certificate in the certificate chain, starting from the root
    // certificate authority.

    // In this example we will simply print the certificate's subject name.
    char subject_name[256];
    X509* cert = X509_STORE_CTX_get_current_cert(ctx.native_handle());
    X509_NAME_oneline(X509_get_subject_name(cert), subject_name, 256);
    std::cout &lt;&lt; "Verifying " &lt;&lt; subject_name &lt;&lt; "\n";

    return preverified;
  }

  std::string get_password() const
  {
    return "Danbay666!";
  }

  void start_accept()
  {
    session* new_session = new session(io_service_, context_);
    acceptor_.async_accept(new_session-&gt;socket(),
        boost::bind(&amp;server::handle_accept, this, new_session,
          boost::asio::placeholders::error));
  }

  void handle_accept(session* new_session,
      const boost::system::error_code&amp; error)
  {
    if (!error)
    {
      new_session-&gt;start();
    }
    else
    {
      delete new_session;
    }

    start_accept();
  }

private:
  boost::asio::io_service&amp; io_service_;
  boost::asio::ip::tcp::acceptor acceptor_;
  boost::asio::ssl::context context_;
};

int main(int argc, char* argv[])
{
  try
  {
    if (argc != 2)
    {
      std::cerr &lt;&lt; "Usage: server &lt;port&gt;\n";
      return 1;
    }

    boost::asio::io_service io_service;

    using namespace std; // For atoi.
    server s(io_service, atoi(argv[1]));

    io_service.run();
  }
  catch (std::exception&amp; e)
  {
    std::cerr &lt;&lt; "Exception: " &lt;&lt; e.what() &lt;&lt; "\n";
  }

  return 0;
}
</pre><h2><a name='header-n56' class='md-header-anchor '></a>[CPP] protobuf 反射</h2><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/protobuf_reflection.cpp'>protobuf_reflection.cpp</a></p><p><strong>参考资料：</strong><a href='https://github.com/chenshuo/recipes' target='_blank' class='url'>https://github.com/chenshuo/recipes</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n60" mdtype="fences" style="break-inside: unset;">#include &lt;google/protobuf/descriptor.h&gt;
#include &lt;google/protobuf/message.h&gt;

#include &lt;string&gt;

#include &lt;arpa/inet.h&gt;  // htonl, ntohl
#include &lt;stdint.h&gt;

// struct ProtobufTransportFormat __attribute__ ((__packed__))
// {
//   int32_t  len;
//   int32_t  nameLen;
//   char     typeName[nameLen];
//   char     protobufData[len-nameLen-4];
// }

const int32_t kHeaderLen = sizeof(int32_t);
///
/// Encode protobuf Message to transport format defined above
/// returns a std::string.
///
/// returns a empty string if message.AppendToString() fails.
///
inline std::string Encode(const google::protobuf::Message&amp; message)
{
    std::string result;

    result.resize(kHeaderLen);

    const std::string&amp; typeName = message.GetTypeName();
    int32_t nameLen = static_cast&lt;int32_t&gt;(typeName.size() + 1);
    int32_t be32 = ::htonl(nameLen);
    result.append(reinterpret_cast&lt;char*&gt;(&amp;be32), sizeof(be32));
    result.append(typeName.c_str(), nameLen);
    bool succeed = message.AppendToString(&amp;result);

    if (succeed)
    {
        int32_t len = ::htonl(result.size() - kHeaderLen);
        std::copy(reinterpret_cast&lt;char*&gt;(&amp;len),
                reinterpret_cast&lt;char*&gt;(&amp;len) + sizeof(len),
                result.begin());
    }
    else
    {
        result.clear();
    }

    return result;
}

inline google::protobuf::Message* CreateMessage(const std::string&amp; type_name)
{
    google::protobuf::Message* message = nullptr;
    const google::protobuf::Descriptor* descriptor =
        google::protobuf::DescriptorPool::generated_pool()-&gt;FindMessageTypeByName(type_name);
    if (descriptor)
    {
        const google::protobuf::Message* prototype =
            google::protobuf::MessageFactory::generated_factory()-&gt;GetPrototype(descriptor);
        if (prototype)
        {
            message = prototype-&gt;New();
        }
    }
    return message;
}

inline int32_t AsInt32(const char* buf)
{
    int32_t be32 = 0;
    ::memcpy(&amp;be32, buf, sizeof(be32));
    return ::ntohl(be32);
}

///
/// Decode protobuf Message from transport format defined above.
/// returns a Message*
///
/// returns nullptr if fails.
///
inline google::protobuf::Message* Decode(const std::string&amp; buf)
{
    google::protobuf::Message* result = nullptr;

    // len(4) + nameLen(4) + typeName(2)
    assert(buf.size() &gt;= (2 * kHeaderLen + 2));
    int32_t len = AsInt32(buf.c_str());
    assert(len == static_cast&lt;int32_t&gt;(buf.size() - kHeaderLen));
    int32_t nameLen = AsInt32(buf.c_str() + kHeaderLen);
    if (nameLen &gt;= 2)
    {
        std::string typeName(buf.begin() + 2 * kHeaderLen,
            buf.begin() + 2 * kHeaderLen + nameLen - 1);
        google::protobuf::Message* message = CreateMessage(typeName);
        if (message)
        {
            const char* data = buf.c_str() + 2 * kHeaderLen + nameLen;
            int32_t dataLen = buf.size() - 2 * kHeaderLen - nameLen;
            if (message-&gt;ParseFromArray(data, dataLen))
            {
                result = message;
            }
            else
            {
                // parse error
                delete message;
            }
        }
        else
        {
            // unknown message type
        }
    }
    else
    {
        // invalid name len
    }

    return result;
}

int main()
{
    ClientInfoReq client_info;
    client_info.set_user_type(2);
    client_info.set_client_id(1101);
    client_info.set_enroll_date("2018-06-01 14:22:39");
    client_info.set_client_name("Jack");

    std::string data = Encode(client_info);

    google::protobuf::Message *message = Decode(data);
    if (dynamic_cast&lt;ClientInfoReq *&gt;(message))
    {
        std::cout &lt;&lt; "succeed to call decode" &lt;&lt; std::endl;
    }

    delete client_info2;
}
</pre><h2><a name='header-n61' class='md-header-anchor '></a>[CPP] 字符串十六进制转换</h2><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/hex_str.cpp'>hex_str.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n64" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;cstdint&gt;
#include &lt;cassert&gt;

const int8_t HexDigitTable[256] = { -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, -1, -1, -1, -1, -1, -1, -1, 0xa, 0xb, 0xc, 0xd, 0xe, 0xf, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0xa, 0xb, 0xc, 0xd, 0xe,
    0xf, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, };

const int8_t HexTable[] = "0123456789abcdef";

std::string Str2Hex(std::string src)
{
    std::string dst;
    dst.reserve(src.size() * 2);

    for (auto itor : src)
    {
        dst.push_back(HexTable[itor &gt;&gt; 4]);
        dst.push_back(HexTable[itor &amp; 0x0f]);
    }

    return dst;
}

std::string Hex2Str(std::string src)
{
    assert(src.size() % 2 == 0);
    std::string dst;
    int8_t c;
    dst.reserve(src.size() / 2);
    for (auto itor = src.begin(); itor != src.end(); ++ itor)
    {
        c = (HexDigitTable[*itor++] &lt;&lt; 4) | HexDigitTable[*itor];
        dst.push_back(c);
    }

    return dst;
}


int main()
{
    std::string src = "hello world";
    std::string dst = Str2Hex(src);
    std::cout &lt;&lt; dst &lt;&lt; std::endl;
    std::cout &lt;&lt; Hex2Str(dst) &lt;&lt; std::endl;

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n66" mdtype="fences">68656c6c6f20776f726c64
hello world
</pre><h2><a name='header-n67' class='md-header-anchor '></a>[CPP] find sub vector</h2><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/find_sub_vector.cpp'>find_sub_vector.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n70" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;  // std::cout
#include &lt;algorithm&gt; // std::find_end
#include &lt;vector&gt;    // std::vector

bool myfunction(int i, int j)
{
    return (i == j);
}

int main()
{
    int myints[] = {1, 2, 3, 4, 5, 1, 2, 3, 4, 5};
    std::vector&lt;int&gt; haystack(myints, myints + 10);

    int needle1[] = {1, 2, 3};

    // using default comparison:
    std::vector&lt;int&gt;::iterator it;
    it = std::find_end(haystack.begin(), haystack.end(), needle1, needle1 + 3);

    if (it != haystack.end())
        std::cout &lt;&lt; "needle1 last found at position " &lt;&lt; (it - haystack.begin()) &lt;&lt; '\n';

    int needle2[] = {4, 5, 1};

    // using predicate comparison:
    it = std::find_end(haystack.begin(), haystack.end(), needle2, needle2 + 3, myfunction);

    if (it != haystack.end())
        std::cout &lt;&lt; "needle2 last found at position " &lt;&lt; (it - haystack.begin()) &lt;&lt; '\n';

    std::vector&lt;int&gt; needle3{3, 4, 5};
    it = std::search(haystack.begin(), haystack.end(), needle3.begin(), needle3.end());
    if (it != haystack.end())
        std::cout &lt;&lt; "needle3 first found at position " &lt;&lt; (it - haystack.begin()) &lt;&lt; '\n';

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n72" mdtype="fences">needle1 last found at position 5
needle2 last found at position 3
needle3 first found at position 2
</pre><h2><a name='header-n73' class='md-header-anchor '></a>[CPP] 实现 strcpy</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="c" contenteditable="false" cid="n74" mdtype="fences" style="break-inside: unset;">char *strcpy(char *dst, const char *src) {
    assert(dst &amp;&amp; src);

    char *ret = dst;
    int len = strlen(src);

    if (dst &gt;= src &amp;&amp; dst &lt;= src + len) {
        dst += len;
        src += len;
        while (len -- &gt;= 0) {
            *dst -- = *src --;
        }
    } else {
        while (len -- &gt;= 0) {
            *dst ++ = *src ++;
        }
    }

    return ret;
}
</pre><h2><a name='header-n75' class='md-header-anchor '></a>[CPP] 排序算法/快速排序</h2><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/quick_sort.cpp'>quick_sort.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n78" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;

int partition(int unsorted[], int low, int high)
{
    int pivot = unsorted[low];
    while (low &lt; high)
    {
        while (low &lt; high &amp;&amp; unsorted[high] &gt; pivot) high--;
        unsorted[low] = unsorted[high];
        while (low &lt; high &amp;&amp; unsorted[low] &lt;= pivot) low++;
        unsorted[high] = unsorted[low];
    }
    unsorted[low] = pivot;
    return low;
}

void quick_sort(int unsorted[], int low, int high)
{
    int loc = 0;
    if (low &lt; high)
    {
        loc = partition(unsorted, low, high);
        quick_sort(unsorted, low, loc - 1);
        quick_sort(unsorted, loc + 1, high);
    }
}

int main()
{
    int x[] = { 6, 21, 4, 13, 51, 9, 21 };
    int len = sizeof(x) / sizeof(int);
    quick_sort(x, 0, len - 1);

    for each (int i in x)
    {
        std::cout &lt;&lt; i &lt;&lt; " ";
    }

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n80" mdtype="fences">4 6 9 13 21 21 51
</pre><h2><a name='header-n81' class='md-header-anchor '></a>[CPP] LRU Cache</h2><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/lru_cache.cpp'>lru_cache.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n84" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;
#include &lt;unordered_map&gt;
#include &lt;vector&gt;

using namespace std;

template &lt;class K, class T&gt;
struct LRUCacheEntry {
    K key;
    T data;
    LRUCacheEntry *prev;
    LRUCacheEntry *next;
};

template &lt;class K, class T&gt;
class LRUCache {
   private:
    unordered_map&lt;K, LRUCacheEntry&lt;K, T&gt; *&gt; mapping;
    vector&lt;LRUCacheEntry&lt;K, T&gt; *&gt; freeEntries;
    LRUCacheEntry&lt;K, T&gt; *head;
    LRUCacheEntry&lt;K, T&gt; *tail;

    LRUCacheEntry&lt;K, T&gt; *entries;

   public:
    LRUCache(size_t size) {
        entries = new LRUCacheEntry&lt;K, T&gt;[size];
        for (int i = 0; i &lt; size; i++) {
            freeEntries.push_back(entries + i);
        }
        head       = new LRUCacheEntry&lt;K, T&gt;;
        tail       = new LRUCacheEntry&lt;K, T&gt;;
        head-&gt;prev = NULL;
        head-&gt;next = tail;
        tail-&gt;next = NULL;
        tail-&gt;prev = head;
    }
    ~LRUCache() {
        delete head;
        delete tail;
        delete[] entries;
    }
    void Debug() {
        cout &lt;&lt; "All cached elements:" &lt;&lt; endl;
        LRUCacheEntry&lt;K, T&gt; *ptr = head;
        while ((ptr = ptr-&gt;next) != tail) {
            cout &lt;&lt; ptr-&gt;key &lt;&lt; " ==&gt; " &lt;&lt; ptr-&gt;data &lt;&lt; endl;
        }
    }
    void Put(K key, T data) {
        LRUCacheEntry&lt;K, T&gt; *node = mapping[key];
        if (node) {
            // refresh the link list
            detach(node);
            node-&gt;data = data;
            attach(node);
        } else {
            // cache is full
            if (freeEntries.empty()) {
                node = tail-&gt;prev;
                detach(node);
                mapping.erase(node-&gt;key);
                node-&gt;data = data;
                node-&gt;key  = key;
                attach(node);
            } else {
                node = freeEntries.back();
                freeEntries.pop_back();
                node-&gt;key    = key;
                node-&gt;data   = data;
                mapping[key] = node;
                attach(node);
            }
        }
    }

    T Get(K key) {
        LRUCacheEntry&lt;K, T&gt; *node = mapping[key];
        if (node) {
            detach(node);
            attach(node);
            return node-&gt;data;
        } else {
            return T();
        }
    }

   private:
    void detach(LRUCacheEntry&lt;K, T&gt; *node) {
        node-&gt;prev-&gt;next = node-&gt;next;
        node-&gt;next-&gt;prev = node-&gt;prev;
    }
    void attach(LRUCacheEntry&lt;K, T&gt; *node) {
        node-&gt;next       = head-&gt;next;
        node-&gt;prev       = head;
        head-&gt;next       = node;
        node-&gt;next-&gt;prev = node;
    }
};

int main() {
    LRUCache&lt;int, string&gt; lruCache(3);
    lruCache.Put(1, "one");
    lruCache.Debug();
    lruCache.Put(2, "two");
    lruCache.Debug();
    lruCache.Put(3, "three");
    lruCache.Debug();
    lruCache.Put(2, "two");
    lruCache.Debug();
    lruCache.Put(4, "four");
    lruCache.Put(1, "one");
    lruCache.Debug();

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n86" mdtype="fences" style="break-inside: unset;">All cached elements:
1 ==&gt; one
All cached elements:
2 ==&gt; two
1 ==&gt; one
All cached elements:
3 ==&gt; three
2 ==&gt; two
1 ==&gt; one
All cached elements:
2 ==&gt; two
3 ==&gt; three
1 ==&gt; one
All cached elements:
1 ==&gt; one
4 ==&gt; four
2 ==&gt; two
</pre><h2><a name='header-n87' class='md-header-anchor '></a>[CPP] SHA256</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n88" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;
#include &lt;iomanip&gt;
#include &lt;sstream&gt;
#include &lt;string&gt;

using namespace std;

#include &lt;openssl/sha.h&gt;

string sha256(const string str)
{
    unsigned char hash[SHA256_DIGEST_LENGTH];
    SHA256_CTX sha256;
    SHA256_Init(&amp;sha256);
    SHA256_Update(&amp;sha256, str.c_str(), str.size());
    SHA256_Final(hash, &amp;sha256);
    stringstream ss;
    for(int i = 0; i &lt; SHA256_DIGEST_LENGTH; i++)
    {
        ss &lt;&lt; hex &lt;&lt; setw(2) &lt;&lt; setfill('0') &lt;&lt; (int)hash[i];
    }
    return ss.str();
}

int main(int argc, char **argv) {
    cout &lt;&lt; sha256(argc == 1 ? "hello world" : argv[1]) &lt;&lt; endl;

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n90" mdtype="fences">root@ubuntu:~# g++ a.cpp  -lcrypto
root@ubuntu:~# ./a.out
b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9
root@ubuntu:~# ./a.out abc
ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad
</pre><h2><a name='header-n91' class='md-header-anchor '></a>[CPP] 自定义结构体排序</h2><p>自定义比较函数遵循”严格弱序“即可，可通过如下两种方式实现。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n93" mdtype="fences" style="break-inside: unset;">#include &lt;string&gt;
#include &lt;set&gt;
#include &lt;iostream&gt;

using namespace std;

// template&lt;class Key, class Compare = std::less&lt;Key&gt;, class Allocator = std::allocator&lt;Key&gt; &gt; class set;

struct Object {
    string id;
    int age;
};

struct ObjectComparator {
    bool operator()(const Object &amp;a, const Object &amp;b) {
        return a.age &lt; b.age;
    }
};

struct Object2 {
    string id;
    int age;

    bool operator&lt;(const Object2 &amp;b) const {
        return age &lt; b.age;
    }
};


int main() {
    Object o1 = {"hello", 22};
    Object o2 = {"world", 33};
    Object o3 = {"x", 22};

    set&lt;Object, ObjectComparator&gt; obj;
    obj.insert(o1);
    obj.insert(o2);
    obj.insert(o3); // insert failed

    for (auto o : obj) {
        cout &lt;&lt; o.id &lt;&lt; ", " &lt;&lt; o.age &lt;&lt; endl;
    }

    Object2 o4 = {"hello", 22};
    Object2 o5 = {"world", 33};
    Object2 o6 = {"x", 22}; // insert failed

    set&lt;Object2&gt; obj2;
    obj2.insert(o4);
    obj2.insert(o5);
    obj2.insert(o6);

    for (auto o : obj2) {
        cout &lt;&lt; o.id &lt;&lt; ", " &lt;&lt; o.age &lt;&lt; endl;
    }

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n95" mdtype="fences">root@ubuntu:~/WaykiChain# ./a.out
hello, 22
world, 33
hello, 22
world, 33
</pre><h2><a name='header-n96' class='md-header-anchor '></a>[CPP] 设计模式/代理模式</h2><p><img src='pic/designpattern/proxy.jpg' alt='' referrerPolicy='no-referrer' /></p><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/proxy.cpp'>proxy.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n100" mdtype="fences" style="break-inside: unset;">#include &lt;string&gt;
#include &lt;iostream&gt;

class Subject
{
public:
    Subject() {}
    virtual ~Subject() {}

public:
    virtual void Request() = 0;
};

class ConcreteSubject : public Subject
{
public:
    ConcreteSubject() {}
    ~ConcreteSubject() {}

public:
    void Request()
    {
        std::cout &lt;&lt; "Done in ConcreteSubject" &lt;&lt; std::endl;
    }
};

class Proxy : public Subject
{
public:
    Proxy(Subject *subject)
    :m_subject(subject)
    {}
    ~Proxy() {}

public:
    void Request()
    {
        std::cout &lt;&lt; "Call ConcreteSubject::Request() to do the job" &lt;&lt; std::endl;
        m_subject-&gt;Request();
    }

private:
    Subject * m_subject;
};


int main()
{
    Subject *subject = new ConcreteSubject();
    Proxy *proxy = new Proxy(subject);

    proxy-&gt;Request();

    delete proxy;
    proxy = nullptr;
    delete subject;
    subject = nullptr;

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n102" mdtype="fences">[root@localhost design_pattern]# g++ proxy.cpp -std=c++11
[root@localhost design_pattern]# ./a.out
Call ConcreteSubject::Request() to do the job
Done in ConcreteSubject
</pre><h2><a name='header-n103' class='md-header-anchor '></a>[CPP] 策略模式</h2><p><img src='pic/designpattern/strategy.jpg' alt='img' referrerPolicy='no-referrer' /></p><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/strategy.cpp'>strategy.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n107" mdtype="fences" style="break-inside: unset;">#include &lt;string&gt;
#include &lt;iostream&gt;

class Strategy
{
public:
    Strategy() {}
    virtual ~Strategy() {}

public:
    virtual void AlgrithmInterface() = 0;
};

class ConcreteStrategyA : public Strategy
{
public:
    ConcreteStrategyA() {}
    ~ConcreteStrategyA() {}

public:
    void AlgrithmInterface()
    {
        std::cout &lt;&lt; "ConcreteStategyA::AlgrithmInterface()" &lt;&lt; std::endl;
    }
};

class ConcreteStrategyB : public Strategy
{
public:
    ConcreteStrategyB() {}
    ~ConcreteStrategyB() {}

public:
    void AlgrithmInterface()
    {
        std::cout &lt;&lt; "ConcreteStrategyB::AlgrithmInterface()" &lt;&lt; std::endl;
    }
};


class  Context
{
public:
    Context(Strategy *strategy)
    {
        m_strategy = strategy;
    }
    ~Context() {}

public:
    void DoAction()
    {
        if (m_strategy)
        {
            m_strategy-&gt;AlgrithmInterface();
        }
    }

private:
    Strategy * m_strategy;
};

int main()
{
    Strategy *strategy = new ConcreteStrategyA();
    Context *context = new Context(strategy);

    context-&gt;DoAction();

    delete strategy;
    strategy = nullptr;
    delete context;
    context = nullptr;

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n109" mdtype="fences">ConcreteStategyA::AlgrithmInterface()
</pre><h2><a name='header-n110' class='md-header-anchor '></a>[CPP] 设计模式/单例模式</h2><p><img src='pic/designpattern/singleton.jpg' alt='img' referrerPolicy='no-referrer' /></p><h3><a name='header-n112' class='md-header-anchor '></a>饿汉式</h3><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/hungry_singleton.cpp'>hungry_singleton.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n115" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;

class Singleton {
public:
    static Singleton* Instance()
    {
        return &amp;m_instance;
    }

private:
    Singleton() {}
    Singleton(const Singleton&amp;) {}
    Singleton&amp; operator=(const Singleton&amp;) {}

    static Singleton m_instance;
};

Singleton Singleton::m_instance;

int main()
{
    Singleton *singleton1 = Singleton::Instance();
    Singleton *singleton2 = Singleton::Instance();

    if (singleton1 == singleton2)
    {
        std::cout &lt;&lt; "Got the same instance" &lt;&lt; std::endl;
    }
    else
    {
        std::cout &lt;&lt; "unexpected error" &lt;&lt; std::endl;
    }

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n117" mdtype="fences">[root@localhost design_pattern]# g++ hungry_singleton.cpp -std=c++11
[root@localhost design_pattern]# ./a.out
Got the same instance
</pre><h3><a name='header-n118' class='md-header-anchor '></a>饱汉式</h3><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/full_singleton.cpp'>full_singleton.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n121" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;

class Singleton {
public:
    static Singleton* Instance()
    {
        if (m_instance == nullptr)
        {
            m_instance = new Singleton();
        }

        return m_instance;
    }

    static void Release()
    {
        if (m_instance != nullptr)
        {
            delete m_instance;
            m_instance = nullptr;
        }
    }

private:
    Singleton() {}
    Singleton(const Singleton&amp;) {}
    Singleton&amp; operator=(const Singleton&amp;) {}

    static Singleton *m_instance;
};

Singleton *Singleton::m_instance = nullptr;

int main()
{
    Singleton *singleton1 = Singleton::Instance();
    Singleton *singleton2 = Singleton::Instance();

    if (singleton1 == singleton2)
    {
        std::cout &lt;&lt; "Got the same instance" &lt;&lt; std::endl;
    }
    else
    {
        std::cout &lt;&lt; "unexpected error" &lt;&lt; std::endl;
    }

    singleton1-&gt;Release();

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n123" mdtype="fences">[root@localhost design_pattern]# g++ full_singleton.cpp -std=c++11
[root@localhost design_pattern]# ./a.out
Got the same instance
</pre><h3><a name='header-n124' class='md-header-anchor '></a>双重检测（线程安全）</h3><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/double_check_singleton.cpp'>double_check_singleton.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n127" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;
#include &lt;mutex&gt;

class Singleton {
public:
    static Singleton* Instance()
    {
        if (m_instance == nullptr)
        {
            m_mtx.lock();
            if (m_instance == nullptr)
            {
                m_instance = new Singleton();
            }
            m_mtx.unlock();
        }

        return m_instance;
    }

    static void Release()
    {
        if (m_instance != nullptr)
        {
            m_mtx.lock();
            if (m_instance != nullptr)
            {
                delete m_instance;
                m_instance = nullptr;
            }
            m_mtx.unlock();
        }
    }

private:
    Singleton() {}
    Singleton(const Singleton&amp;) {}
    Singleton&amp; operator=(const Singleton&amp;) {}

    static Singleton *m_instance;
    static std::mutex m_mtx;
};

Singleton *Singleton::m_instance = nullptr;
std::mutex Singleton::m_mtx;

int main()
{
    Singleton *singleton1 = Singleton::Instance();
    Singleton *singleton2 = Singleton::Instance();

    if (singleton1 == singleton2)
    {
        std::cout &lt;&lt; "Got the same instance" &lt;&lt; std::endl;
    }
    else
    {
        std::cout &lt;&lt; "unexpected error" &lt;&lt; std::endl;
    }

    singleton1-&gt;Release();

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n129" mdtype="fences">[root@localhost design_pattern]# g++ double_check_singleton.cpp -std=c++11
[root@localhost design_pattern]# ./a.out
Got the same instance
</pre><h3><a name='header-n130' class='md-header-anchor '></a>模板</h3><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/template_singleton.cpp'>template_singleton.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n133" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;
#include &lt;mutex&gt;

template&lt;typename T&gt;
class Singleton {
public:
    static T* Instance()
    {
        if (m_instance == nullptr)
        {
            m_instance = new T();
        }

        return m_instance;
    }

    static void Release()
    {
        if (m_instance != nullptr)
        {
            delete m_instance;
            m_instance = nullptr;
        }
    }

private:
    Singleton() {}
    Singleton(const Singleton&amp;) {}
    Singleton&amp; operator=(const Singleton&amp;) {}

    static T *m_instance;
};

template&lt;typename T&gt;
T *Singleton&lt;T&gt;::m_instance = nullptr;

class A
{
public:
    void SayHello()
    {
        std::cout &lt;&lt; "hello world" &lt;&lt; std::endl;
    }
};

int main()
{
    A *a1 = Singleton&lt;A&gt;::Instance();
    A *a2 = Singleton&lt;A&gt;::Instance();
    if (a1 == a2)
    {
        std::cout &lt;&lt; "Got the same instance" &lt;&lt; std::endl;
    }
    else
    {
        std::cout &lt;&lt; "unexpected error" &lt;&lt; std::endl;
    }

    a1-&gt;SayHello();

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n135" mdtype="fences">[root@localhost design_pattern]# g++ template_singleton.cpp -std=c++11
[root@localhost design_pattern]# ./a.out
Got the same instance
hello world
</pre><h2><a name='header-n136' class='md-header-anchor '></a>[CPP] 设计模式/适配器模式</h2><h3><a name='header-n137' class='md-header-anchor '></a>类适配器</h3><p><img src='pic/designpattern/class_adapter.jpg' alt='img' referrerPolicy='no-referrer' /></p><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/class_adapter.cpp'>class_adapter.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n141" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;

class Target
{
public:
    Target() {}
    virtual ~Target() {}

public:
    virtual void Request() = 0;
};

class Adaptee
{
public:
    Adaptee(){}
    virtual ~Adaptee() {}

public:
    virtual void SpecificRequest() = 0;
};

class Adapter : public Target, public Adaptee
{
public:
    Adapter() {}
    ~Adapter() {}

public:
    void Request()
    {
        std::cout &lt;&lt; "Transfer Specific Request to Reuest" &lt;&lt; std::endl;
        SpecificRequest();
        std::cout &lt;&lt; "Finally, Request" &lt;&lt; std::endl;
    }

    void SpecificRequest()
    {
        std::cout &lt;&lt; "Specific Request" &lt;&lt; std::endl;
    }
};

int main()
{
    Target *target = new Adapter();
    target-&gt;Request();

    delete target;
    target = nullptr;

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n143" mdtype="fences">[root@localhost design_pattern]# g++ class_adapter.cpp -std=c++11
[root@localhost design_pattern]# ./a.out
Transfer Specific Request to Reuest
Specific Request
Finally, Request
</pre><h3><a name='header-n144' class='md-header-anchor '></a>对象适配器</h3><p><img src='pic/designpattern/object_adapter.jpg' alt='' referrerPolicy='no-referrer' /></p><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/object_adapter.cpp'>object_adapter.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n148" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;

class Target
{
public:
    Target() {}
    virtual ~Target() {}

public:
    virtual void Request() = 0;
};

class Adaptee
{
public:
    Adaptee(){}
    virtual ~Adaptee() {}

public:
    void SpecificRequest()
    {
        std::cout &lt;&lt; "Specific Request" &lt;&lt; std::endl;
    }
};

class Adapter : public Target
{
public:
    Adapter(Adaptee *adaptee) {}
    ~Adapter() {}

public:
    void Request()
    {
        std::cout &lt;&lt; "Transfer Specific Request to Reuest" &lt;&lt; std::endl;
        m_adaptee-&gt;SpecificRequest();
        std::cout &lt;&lt; "Finally, Request" &lt;&lt; std::endl;
    }

private:
    Adaptee * m_adaptee;
};

int main()
{
    Adaptee *adaptee = new Adaptee();
    Target *target = new Adapter(adaptee);
    target-&gt;Request();

    delete target;
    target = nullptr;

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n150" mdtype="fences">[root@localhost design_pattern]# g++ object_adapter.cpp -std=c++11
[root@localhost design_pattern]# ./a.out
Transfer Specific Request to Reuest
Specific Request
Finally, Request
</pre><h2><a name='header-n151' class='md-header-anchor '></a>[CPP] 设计模式/桥接模式</h2><p><img src='pic/designpattern/bridge.jpg' alt='img' referrerPolicy='no-referrer' /></p><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/bridge.cpp'>bridge.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n155" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;
#include &lt;string&gt;

class USB
{
public:
    USB() {}
    virtual ~USB() {}

public:
    virtual void Transfer() = 0;
};

// USB 2.0
class USB20 : public USB
{
public:
    USB20() {}
    ~USB20() {}

public:
    void Transfer()
    {
        std::cout &lt;&lt; "Transfer by USB 2.0" &lt;&lt; std::endl;
    }
};

// USB 3.0
class USB30 : public USB
{
public:
    USB30() {}
    ~USB30() {}

public:
    void Transfer()
    {
        std::cout &lt;&lt; "Transfer by USB 3.0, faster" &lt;&lt; std::endl;
    }
};

class PC
{
public:
    PC() {}
    virtual ~PC() {}

public:
    virtual void Transfer(USB *usb) = 0;
};

class DellPC : public PC
{
public:
    DellPC() {}
    ~DellPC() {}

public:
    void Transfer(USB *usb)
    {
        std::cout &lt;&lt; "Dell PC, try to transfer data by USB device" &lt;&lt; std::endl;
        usb-&gt;Transfer();
    }
};


int main()
{
    USB *usb20 = new USB20();
    USB *usb30 = new USB30();

    PC *pc = new DellPC();

    pc-&gt;Transfer(usb20);
    pc-&gt;Transfer(usb30);

    delete usb20;
    usb20 = nullptr;
    delete usb30;
    usb30 = nullptr;
    delete pc;
    pc = nullptr;

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n157" mdtype="fences">[root@localhost design_pattern]# g++ bridge.cpp -std=c++11
[root@localhost design_pattern]# ./a.out
Dell PC, try to transfer data by USB device
Transfer by USB 2.0
Dell PC, try to transfer data by USB device
Transfer by USB 3.0, faster
</pre><h2><a name='header-n158' class='md-header-anchor '></a>[CPP] 设计模式/观察者模式</h2><p><img src='pic/designpattern/observer.jpg' alt='img' referrerPolicy='no-referrer' /></p><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/observer.cpp'>observer.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n162" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;
#include &lt;list&gt;
#include &lt;string&gt;

class Observer
{
public:
    Observer() {}
    virtual ~Observer() {}

public:
    virtual void Update(int status) = 0;
};

class ConcreteObserver : public Observer
{
public:
    ConcreteObserver() {}
    ~ConcreteObserver() {}

public:
    void Update(int status)
    {
        std::cout &lt;&lt; "The target subject is changing status: " &lt;&lt; status &lt;&lt; std::endl;
    }
};

class Subject
{
public:
    Subject() {}
    virtual ~Subject() {}

public:
    virtual void Attach(Observer *observer) = 0;
    virtual void Detach(Observer *observer) = 0;
    virtual void Notify() = 0;
    virtual void SetStatus(int status) = 0;
    virtual int GetStatus() = 0;

private:
    int status;
};

class ConcreteSubject : public Subject
{
public:
    ConcreteSubject() {}
    virtual ~ConcreteSubject() {}

    void Attach(Observer *observer)
    {
        m_observers.push_back(observer);
    }

    void Detach(Observer* observer)
    {
        m_observers.remove(observer);
    }

    void Notify()
    {
        for (auto itor = m_observers.begin(); itor != m_observers.end(); itor++)
        {
            (*itor)-&gt;Update(m_status);
        }
    }

    void SetStatus(int status)
    {
        m_status = status;
    }

    int GetStatus()
    {
        return m_status;
    }

private:
    std::list&lt;Observer*&gt; m_observers;
    int m_status;
};

int main()
{
    Observer *observer = new ConcreteObserver();
    Subject *subject = new ConcreteSubject();

    subject-&gt;Attach(observer);
    subject-&gt;SetStatus(99);
    std::cout &lt;&lt; "Subject's status: " &lt;&lt; subject-&gt;GetStatus() &lt;&lt; std::endl;
    subject-&gt;Notify();

    subject-&gt;Detach(observer);

    delete observer;
    observer = nullptr;
    delete subject;
    subject = nullptr;

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n164" mdtype="fences">[root@localhost design_pattern]# g++ observer.cpp -std=c++11
[root@localhost design_pattern]# ./a.out
Subject's status: 99
The target subject is changing status: 99
</pre><h2><a name='header-n165' class='md-header-anchor '></a>[CPP] 设计模式/装饰器模式</h2><p><img src='pic/designpattern/decorator.jpg' alt='img' referrerPolicy='no-referrer' /></p><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/decorator.cpp'>decorator.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="c++" contenteditable="false" cid="n169" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;
#include &lt;string&gt;

class Phone
{
public:
    Phone() {}
    virtual ~Phone() {}
    virtual void ShowDecorate() = 0;
};

class iPhone : public Phone
{
public:
    iPhone(std::string name)
        : m_name(name) {}
    ~iPhone() {}
    void ShowDecorate()
    {
        std::cout &lt;&lt; "Name: " &lt;&lt; m_name &lt;&lt; std::endl;
    }

private:
    std::string m_name;

};

class NokiaPhone : public Phone
{
public:
    NokiaPhone(std::string name)
        : m_name(name)
    {
    }
    ~NokiaPhone()
    {
    }
    void ShowDecorate()
    {
        std::cout &lt;&lt; "Name: " &lt;&lt; m_name &lt;&lt; std::endl;
    }

private:
    std::string m_name;
};

class DecoratorPhone : public Phone
{
public:
    DecoratorPhone(Phone *phone)
        : m_phone(phone)
    {
    }
    virtual void ShowDecorate()
    {
        m_phone-&gt;ShowDecorate();
    }

private:
    Phone *m_phone;
};

class DecoratePhoneA : public DecoratorPhone
{
public:
    DecoratePhoneA(Phone *ph)
        : DecoratorPhone(ph)
    {
    }
    void ShowDecorate()
    {
        DecoratorPhone::ShowDecorate();
        AddDecorate();
    }

private:
    void AddDecorate()
    {
        std::cout &lt;&lt; "Decorator: HiFi Audio System" &lt;&lt; std::endl;
    }
};

class DecoratePhoneB : public DecoratorPhone
{
public:
    DecoratePhoneB(Phone *ph)
        : DecoratorPhone(ph)
    {
    }
    void ShowDecorate()
    {
        DecoratorPhone::ShowDecorate();
        AddDecorate();
    }

private:
    void AddDecorate()
    {
        std::cout &lt;&lt; "Decorator: Duel Camera" &lt;&lt; std::endl;
    }
};

int main()
{
    Phone *nokia = new NokiaPhone("Nokia N8");
    Phone *iphone = new iPhone("iPhone 4");
    Phone *dpa = new DecoratePhoneA(nokia);
    Phone *dpb = new DecoratePhoneB(iphone);

    nokia-&gt;ShowDecorate();
    dpa-&gt;ShowDecorate();
    dpb-&gt;ShowDecorate();

    delete nokia;
    nokia = nullptr;
    delete iphone;
    iphone = nullptr;
    delete dpa;
    dpa = nullptr;
    delete dpb;
    dpb = nullptr;

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n171" mdtype="fences">[root@localhost design_pattern]# g++ decorator.cpp -std=c++11
[root@localhost design_pattern]# ./a.out
Name: Nokia N8
Name: Nokia N8
Decorator: HiFi Audio System
Name: iPhone 4
Decorator: Duel Camera
</pre><h2><a name='header-n172' class='md-header-anchor '></a>[CPP] 设计模式/职责链模式</h2><p><img src='pic/designpattern/chain_of_responsibility.jpg' alt='img' referrerPolicy='no-referrer' /></p><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/chain_of_responsibility.cpp'>chain_of_responsibility.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n176" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;

class Handler
{
public:
    Handler() {}
    virtual ~Handler() {}

public:
    virtual void HandleRequest(int count) = 0;
    void SetSuccessor(Handler *successor)
    {
        m_successor = successor;
    }
    Handler *GetSuccessor()
    {
        return m_successor;
    }

protected:
    Handler *m_successor;
};

class ConcreteHandlerA : public Handler
{
public:
    ConcreteHandlerA() {}
    ~ConcreteHandlerA() {}

public:
    void HandleRequest(int count)
    {
        if (count &lt; 100)
        {
            std::cout &lt;&lt; "A: I can do it, done" &lt;&lt; std::endl;
        }
        else
        {
            std::cout &lt;&lt; "A: I can not do it, next" &lt;&lt; std::endl;
            if (GetSuccessor() != nullptr)
            {
                GetSuccessor()-&gt;HandleRequest(count);
            }
        }
    }
};

class ConcreteHandlerB : public Handler
{
public:
    ConcreteHandlerB() {}
    ~ConcreteHandlerB() {}

public:
    void HandleRequest(int count)
    {
        if (count &gt;= 100)
        {
            std::cout &lt;&lt; "B: I can do it, done" &lt;&lt; std::endl;
        }
    }
};

int main()
{
    Handler *a = new ConcreteHandlerA();
    Handler *b = new ConcreteHandlerB();
    a-&gt;SetSuccessor(b);

    a-&gt;HandleRequest(50);
    a-&gt;HandleRequest(150);

    a-&gt;SetSuccessor(nullptr);
    delete b;
    b = nullptr;
    delete a;
    a = nullptr;

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n178" mdtype="fences">[root@localhost design_pattern]# g++ chain_of_responsibility.cpp -std=c++11
[root@localhost design_pattern]# ./a.out
A: I can do it, done
A: I can not do it, next
B: I can do it, done
</pre><h2><a name='header-n179' class='md-header-anchor '></a>[CPP] 设计模式/模板方法模式</h2><p><img src='pic/designpattern/template_function.jpg' alt='' referrerPolicy='no-referrer' /></p><blockquote><p><strong>源码路径：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/template_function.cpp'>template_function.cpp</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n183" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;
#include &lt;string&gt;

class AbstractClass
{
public:
    AbstractClass() {}
    virtual ~AbstractClass() {}

public:
    void TemplateMethod()
    {
        this-&gt;Primitive1();
        this-&gt;Primitive2();
    }

protected:
    virtual void Primitive1() = 0;
    virtual void Primitive2() = 0;
};

class ConcreteClass1 : public AbstractClass
{
public:
    ConcreteClass1() {}
    ~ConcreteClass1() {}
protected:
    void Primitive1()
    {
        std::cout &lt;&lt; "ConcreteClass1::Primitive1()" &lt;&lt; std::endl;
    }
    void Primitive2()
    {
        std::cout &lt;&lt; "ConcreteClass1::Primitive2()" &lt;&lt; std::endl;
    }
};

class ConcreteClass2 : public AbstractClass
{
public:
    ConcreteClass2() {}
    ~ConcreteClass2() {}
protected:
    void Primitive1()
    {
        std::cout &lt;&lt; "ConcreteClass2::Primitive1()" &lt;&lt; std::endl;
    }
    void Primitive2()
    {
        std::cout &lt;&lt; "ConcreteClass2::Primitive2()" &lt;&lt; std::endl;
    }
};

int main(int argc, char* argv[]) {
    AbstractClass* p1 = new ConcreteClass1();
    AbstractClass* p2 = new ConcreteClass2();

    p1-&gt;TemplateMethod();
    p2-&gt;TemplateMethod();

    delete p1;
    p1 = nullptr;
    delete p2;
    p2 = nullptr;

    return 0;
}
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n185" mdtype="fences">[root@localhost design_pattern]# g++ template_function.cpp -std=c++11
[root@localhost design_pattern]# ./a.out
ConcreteClass1::Primitive1()
ConcreteClass1::Primitive2()
ConcreteClass2::Primitive1()
ConcreteClass2::Primitive2()
</pre><h2><a name='header-n186' class='md-header-anchor '></a>[CPP] LevelDB 基础使用</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="cpp" contenteditable="false" cid="n187" mdtype="fences" style="break-inside: unset;">#include &lt;iostream&gt;
#include &lt;cassert&gt;
#include "leveldb/db.h"
#include "leveldb/write_batch.h"

int main()
{
    // Open a database.
    leveldb::DB* db;
    leveldb::Options opts;
    opts.create_if_missing = true;
    leveldb::Status status = leveldb::DB::Open(opts, "./testdb", &amp;db);
    assert(status.ok());

    // Write data.
    status = db-&gt;Put(leveldb::WriteOptions(), "key", "value");
    assert(status.ok());

    // Read data.
    std::string val;
    status = db-&gt;Get(leveldb::ReadOptions(), "key", &amp;val);
    assert(status.ok());
    std::cout &lt;&lt; val &lt;&lt; std::endl;

    // Batch atomic write.
    leveldb::WriteBatch batch;
    batch.Delete("key");
    batch.Put("key0", "value0");
    batch.Put("key1", "value1");
    batch.Put("key2", "value2");
    status = db-&gt;Write(leveldb::WriteOptions(), &amp;batch);
    assert(status.ok());

    // Scan database.
    leveldb::Iterator* it = db-&gt;NewIterator(leveldb::ReadOptions());
    for (it-&gt;SeekToFirst(); it-&gt;Valid(); it-&gt;Next()) {
        std::cout &lt;&lt; it-&gt;key().ToString() &lt;&lt; ": " &lt;&lt;
          it-&gt;value().ToString() &lt;&lt; std::endl;
    }
    assert(it-&gt;status().ok());

    // Range scan, example: [key1, value2)
    for (it-&gt;Seek("key1");
         it-&gt;Valid() &amp;&amp; it-&gt;key().ToString() &lt; "value2";
         it-&gt;Next()) {
        std::cout &lt;&lt; it-&gt;key().ToString() &lt;&lt; ": " &lt;&lt;
          it-&gt;value().ToString() &lt;&lt; std::endl;
    }

    // Close a database.
    delete db;
}
</pre><h2><a name='header-n188' class='md-header-anchor '></a>[Python] 输出不换行</h2><blockquote><p><strong>环境：</strong>Python 2.7.14</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n191" mdtype="fences"># -*- coding:utf-8 -*-

if __name__ == '__main__':
    print("hello")
    print("world")

    print("hello"),
    print("world")
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n193" mdtype="fences">hello
world
hello world
</pre><h2><a name='header-n194' class='md-header-anchor '></a>[Python] 获取 unixstamp</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n195" mdtype="fences" style="break-inside: unset;">import time
import datetime
import calendar

original_seconds = time.time()
print original_seconds

seconds = int(time.time())
print seconds

millis = int(round(time.time() * 1000))
print millis

now = datetime.datetime.utcnow()
tt = long(calendar.timegm(now.utctimetuple()))
print tt
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n197" mdtype="fences">1527122035.76
1527122035
1527122035756
1527122035
</pre><h2><a name='header-n198' class='md-header-anchor '></a>[Python] 日期时间格式化</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n199" mdtype="fences" style="break-inside: unset;"># -*- coding:utf-8 -*-

import datetime
import time

if __name__ == '__main__':

    date = datetime.datetime.now().strftime("%Y-%m-%d")
    print(date)

    now = datetime.datetime.strptime("2018-04-25 18:00:34.123456", "%Y-%m-%d %H:%M:%S.%f")
    print(now)

    now = datetime.datetime.utcnow()
    vn_now = now + datetime.timedelta(hours=7)
    vn_date = vn_now.strftime("%Y-%m-%d")
    print(vn_date)
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n201" mdtype="fences">2018-05-24
2018-04-25 18:00:34.123456
2018-05-24
</pre><h2><a name='header-n202' class='md-header-anchor '></a>[Python] 计算比特币发行总量</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n203" mdtype="fences" style="break-inside: unset;"># -*- coding: utf-8 -*-

# 初始的块奖励为 50 BTC
start_block_reward = 50
# 以10分钟为一个区块的间隔，210000 个块共约 4 年时间
reward_interval = 210000

def max_money():
    # 50 BTC = 50 0000 0000 Satoshis
    current_reward = 50 * 10**8
    total = 0
    while current_reward &gt; 0:
        total += reward_interval * current_reward
        current_reward /= 2
    return total

print "Total BTC to ever be created:", max_money(), "Satoshis"
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n205" mdtype="fences">Total BTC to ever be created: 2099999997690000 Satoshis
</pre><h2><a name='header-n206' class='md-header-anchor '></a>[Python] 简化的工作量证明算法</h2><blockquote><p>可以任意调整难度值（按二进制 bit 数来设定，即哈希值开头多少个 bit 必须是 0）</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n209" mdtype="fences" style="break-inside: unset;"># -*- coding: utf-8 -*-
# example of proof-of-work algorithm

import hashlib
import time

max_nonce = 2 ** 32 # 4 billion

def proof_of_work(header, difficulty_bits):

    # calculate the difficulty target
    target = 2 ** (256-difficulty_bits)

    for nonce in xrange(max_nonce):
        hash_result = hashlib.sha256(str(header)+str(nonce)).hexdigest()

        # check if this is a valid result, below the target

        if long(hash_result, 16) &lt; target:
            print "Success with nonce %d" % nonce
            print "Hash is %s" % hash_result
            return (hash_result,nonce)

    print "Failed after %d (max_nonce) tries" % nonce
    return nonce

if __name__ == '__main__':

    nonce = 0
    hash_result = ''

    # difficulty from 0 to 31 bits
    for difficulty_bits in xrange(32):

        difficulty = 2 ** difficulty_bits
        print "Difficulty: %ld (%d bits)" % (difficulty, difficulty_bits)

        print "Starting search..."

        # checkpoint the current time
        start_time = time.time()

        # make a new block which includes the hash from the previous block
        # we fake a block of transactions - just a string
        new_block = 'test block with transactions' + hash_result

        # find a valid nonce for the new block
        (hash_result, nonce) = proof_of_work(new_block, difficulty_bits)

        # checkpoint how long it took to find a result
        end_time = time.time()

        elapsed_time = end_time - start_time
        print "Elapsed Time: %.4f seconds" % elapsed_time

        if elapsed_time &gt; 0:

            # estimate the hashes per second
            hash_power = float(long(nonce)/elapsed_time)
            print "Hashing Power: %ld hashes per second" % hash_power
</pre><p><strong>输出</strong></p><blockquote><p>输出较多，仅列出一小部分</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n213" mdtype="fences" style="break-inside: unset;">Difficulty: 1 (0 bits)
Starting search...
Success with nonce 0
Hash is ff8253ed10b5f719d52a709a66af8cd5e2054f702e675af4ca0cae70f0988634
Elapsed Time: 0.0001 seconds
Hashing Power: 0 hashes per second
Difficulty: 2 (1 bits)
Starting search...
Success with nonce 0
Hash is 22c608547e239faf5c353e7ebd204042760b93891d1d0be9ab488d36c73c077b
Elapsed Time: 0.0000 seconds
Hashing Power: 0 hashes per second
Difficulty: 4 (2 bits)
Starting search...
Success with nonce 2
Hash is 0635f41cdb98c6e73516f84fc88da19a13a3bac6298dbfc0df5170bac93ba4dd
Elapsed Time: 0.0000 seconds
Hashing Power: 55553 hashes per second
Difficulty: 8 (3 bits)
Starting search...
Success with nonce 9
Hash is 1c1c105e65b47142f028a8f93ddf3dabb9260491bc64474738133ce5256cb3c1
Elapsed Time: 0.0001 seconds
Hashing Power: 140329 hashes per second
Difficulty: 16 (4 bits)
Starting search...
Success with nonce 25
Hash is 0f7becfd3bcd1a82e06663c97176add89e7cae0268de46f94e7e11bc3863e148
Elapsed Time: 0.0001 seconds
Hashing Power: 227456 hashes per second
Difficulty: 32 (5 bits)
Starting search...
Success with nonce 36
Hash is 029ae6e5004302a120630adcbb808452346ab1cf0b94c5189ba8bac1d47e7903
Elapsed Time: 0.0003 seconds
Hashing Power: 108085 hashes per second
Difficulty: 64 (6 bits)
Starting search...
Success with nonce 0
Hash is 0083214fa878cea749bd07bd77e92b311be876dd72f3d4924d5ae4ead54febe5
Elapsed Time: 0.0001 seconds
Hashing Power: 0 hashes per second
Difficulty: 128 (7 bits)
Starting search...
Success with nonce 26
Hash is 00f7abab177613afc42270e3f5f79ffddd694093030663b32fe26ce2a377a993
Elapsed Time: 0.0008 seconds
Hashing Power: 32956 hashes per second
Difficulty: 256 (8 bits)
</pre><h2><a name='header-n214' class='md-header-anchor '></a>[Python] 字串串十六进制转换</h2><blockquote><p><strong>环境：</strong>Python 2.7.14</p><p><strong>源码：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/hex_str.py'>点此下载</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n218" mdtype="fences" style="break-inside: unset;">#!/usr/bin/env python
# -*- coding: utf-8 -*-

import sys

choose = ""
data = ""


def hex2char():
    output = data.decode('hex')
    print output


def char2hex():
    output = data.encode('hex')
    print output


if __name__ == '__main__':
    if len(sys.argv) == 3:
        choose = sys.argv[1]
        data = sys.argv[2]

        if choose.lower() == 'hex2char':
            hex2char()
        if choose.lower() == 'char2hex':
            char2hex()

        if choose.lower() != 'hex2char' and choose.lower() != 'char2hex':
            print "Wrong param,try again"
    else:
        print "Usage: &lt;hex2char|char2hex&gt; &lt;data&gt;"

</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n220" mdtype="fences">$ ./hex_str.py char2hex "hello wolrd"
68656c6c6f20776f6c7264
$ ./hex_str.py hex2char "68656c6c6f20776f6c7264"
hello wolrd
</pre><h2><a name='header-n221' class='md-header-anchor '></a>[Python] 列表</h2><h3><a name='header-n222' class='md-header-anchor '></a>列表的遍历</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n223" mdtype="fences" style="break-inside: unset;">#!/usr/bin/env python
# -*- coding: utf-8 -*-

if __name__ == '__main__':
    my_list = ['html', 'js', 'css', 'python']

    for i in my_list:
        print("index:%d, value:%s" % (my_list.index(i), i))

    for i in range(len(my_list)):
        print("index:%d, value:%s" % (i, my_list[i]))

    for i, val in enumerate(my_list):
        print("index:%d, value:%s" % (i, val))

    # 只是改变索引的输出，默认从 0 开始，如下设置从 2 开始
    for i, val in enumerate(my_list, 2):
        print("index:%d, value:%s" % (i, val))
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n225" mdtype="fences" style="break-inside: unset;">index:0, value:html
index:1, value:js
index:2, value:css
index:3, value:python
index:0, value:html
index:1, value:js
index:2, value:css
index:3, value:python
index:0, value:html
index:1, value:js
index:2, value:css
index:3, value:python
index:2, value:html
index:3, value:js
index:4, value:css
index:5, value:python
</pre><h3><a name='header-n226' class='md-header-anchor '></a>列表的去重</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n227" mdtype="fences">#!/usr/bin/env python
# -*- coding: utf-8 -*-

if __name__ == '__main__':
    my_list = ['html', 'js', 'css', 'python', 'cpp', 'css']
    print my_list

    my_set = set(my_list)
    my_list = [x for x in my_set]
    print my_list
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n229" mdtype="fences">['html', 'js', 'css', 'python', 'cpp', 'css']
['python', 'cpp', 'html', 'css', 'js']
</pre><h2><a name='header-n230' class='md-header-anchor '></a>[Python] 集合</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n231" mdtype="fences" style="break-inside: unset;">#!/usr/bin/env python
# -*- coding: utf-8 -*-

import traceback

if __name__ == '__main__':
    set1 = set([1, 3, 5, 6, 7])
    set2 = set([2, 3, 4, 5, 8])

    print "set1:", set1
    print "set2:", set2

    if 4 in set1:
        print "4 in set1"
    else:
        print "4 not in set1"

    # 添加元素
    set1.add(9)
    print "set1:", set1
    set1.update([9, 10, 11])
    print "set1:", set1

    # 删除元素
    try:
        set1.remove(99)
    except Exception as ex:
        print traceback.format_exc()
    print "after remove 99, set1:", set1
    set1.discard(99)
    print "after discard 99, set1:", set1
    set1.remove(10)
    print "after remove 10, set1:", set1
    set1.discard(9)
    print "after discard 9, set1:", set1

    # 测试是否 set1 中每一个元素都在 set2 中
    if set1.issubset(set2):
        print "set1 is subset of set2"
    else:
        print "set1 is not subset of set2"

    # 测试是否 set2 中每一个元素都在 set1 中
    if set1.issuperset(set2):
        print "set1 is superset of set2"
    else:
        print "set1 is not superset of set2"

    print "set1:", set1
    print "set2:", set2
    # x ∈ set1 || x ∈ set2
    print set1.union(set2)
    # (x ∈ set1 &amp;&amp; x ∉ set2) || (x ∈ set2 &amp;&amp; x ∉ set1)
    print set1.symmetric_difference(set2)
    # x ∈ set1 &amp;&amp; x ∈ set2
    print set1.intersection(set2)
    # x ∈ set1 &amp;&amp; x ∉ set2
    print set1.difference(set2)
    print set2.difference(set1)
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n233" mdtype="fences" style="break-inside: unset;">set1: set([1, 3, 5, 6, 7])
set2: set([8, 2, 3, 4, 5])
4 not in set1
set1: set([1, 3, 5, 6, 7, 9])
set1: set([1, 3, 5, 6, 7, 9, 10, 11])
Traceback (most recent call last):
  File "d:\Blog\archives\debug\debug.py", line 26, in &lt;module&gt;
    set1.remove(99)
KeyError: 99

after remove 99, set1: set([1, 3, 5, 6, 7, 9, 10, 11])
after discard 99, set1: set([1, 3, 5, 6, 7, 9, 10, 11])
after remove 10, set1: set([1, 3, 5, 6, 7, 9, 11])
after discard 9, set1: set([1, 3, 5, 6, 7, 11])
set1 is not subset of set2
set1 is not superset of set2
set1: set([1, 3, 5, 6, 7, 11])
set2: set([8, 2, 3, 4, 5])
set([1, 2, 3, 4, 5, 6, 7, 8, 11])
set([1, 2, 4, 6, 7, 8, 11])
set([3, 5])
set([1, 11, 6, 7])
set([8, 2, 4])
</pre><h2><a name='header-n234' class='md-header-anchor '></a>[Python] range 与 xrange</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n235" mdtype="fences" style="break-inside: unset;"># -*- coding: utf-8 -*-

for i in range(2, 10, 3):
    print i

for i in range(3):
    print i

print range(2, 10, 2)


for j in xrange(2, 10, 3):
    print j

for j in xrange(3):
    print j

print xrange(2, 10, 2)
print list(xrange(2, 10, 2))
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n237" mdtype="fences" style="break-inside: unset;">2
5
8
0
1
2
[2, 4, 6, 8]
2
5
8
0
1
2
xrange(2, 10,
[2, 4, 6, 8]
</pre><h2><a name='header-n238' class='md-header-anchor '></a>[Python] 字典的遍历</h2><blockquote><p><strong>效率：</strong>由高到低，性能要求高的地方需要注意</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n241" mdtype="fences" style="break-inside: unset;">from time import clock

l = [(x, x) for x in xrange(1000000)]
d = dict(l)

t0 = clock()
for i in d:
    t = i + d[i]
t1 = clock()

for k, v in d.iteritems():
    t = k + v
t2 = clock()

for k, v in zip(d.iterkeys(), d.itervalues()):
    t = k + v
t3 = clock()

for k, v in d.items():
    t = k + v
t4 = clock()

print t1-t0, t2-t1, t3-t2, t4-t3
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n243" mdtype="fences">0.147005027863 0.151357206668 0.273842580021 0.696996068627
</pre><h2><a name='header-n244' class='md-header-anchor '></a>[Python] 构造、析构</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n245" mdtype="fences" style="break-inside: unset;">class X(object):
    def __init__(self, a, b, range):
        self.a = a
        self.b = b
        self.range = range
        print('__init__ with {}, {}, {}'.format(self.a, self.b, self.range))

    def __call__(self, a, b):
        self.a = a
        self.b = b
        print('__call__ with {}, {}'.format(self.a, self.b))

    def __del__(self):
        del self.a
        del self.b
        del self.range
        print('__del__')


if __name__ == '__main__':
    x = X(1, 2, 3)
    x(3, 4)
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n247" mdtype="fences">__init__ with 1, 2, 3
__call__ with 3, 4
__del__
</pre><h2><a name='header-n248' class='md-header-anchor '></a>[Python] 全局变量</h2><ul><li>全局变量可在函数中直接使用</li><li>函数中存在同名变量，局部变量覆盖全局变量作用域</li><li>函数中显示声明 global var，实现对全局变量的修改；对于列表、字典等全局变量，不需要额外的 global 声明</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n256" mdtype="fences" style="break-inside: unset;">#! /usr/bin/python

a = 1
b = [2, 3]


def func1():
    a = 11
    print "in func1 a:", a
    b[0] = 22
    print "in func1 b:", b


def func2():
    global a
    a = 11
    print "in func a:", a
    b[1] = 33
    print "in func b:", b


if __name__ == '__main__':
    print "init, a:", a
    print "init, b:", b

    func1()

    print "after func1 a:", a
    print "after func1 b:", b

    func2()

    print "after func2 a:", a
    print "after func2 b:", b
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n258" mdtype="fences">init, a: 1
init, b: [2, 3]
in func1 a: 11
in func1 b: [22, 3]
after func1 a: 1
after func1 b: [22, 3]
in func a: 11
in func b: [22, 33]
after func2 a: 11
after func2 b: [22, 33]
</pre><h2><a name='header-n259' class='md-header-anchor '></a>[Python] lambda 表达式</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n260" mdtype="fences" style="break-inside: unset;"># -*- coding: utf-8 -*-

# 常规使用
f = lambda x : x + 1
print f(99)

# 映射
print map(lambda x : x + 1, [1, 2, 3])
print map(lambda x: x*x, [y for y in range(10)])

# 过滤
foo = [2, 18, 9, 22, 17, 24, 8, 12, 27]
print filter(lambda x : x % 3 == 0, foo)

# 归纳
print reduce(lambda x, y : x + y, foo)

# 闭包
def add(n):
    return lambda x : x + n

print add(3)(5)
# 等价于
add_3 = add(3)
print add_3(5)
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n262" mdtype="fences">100
[2, 3, 4]
[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]
[18, 9, 24, 12, 27]
139
8
8
</pre><h2><a name='header-n263' class='md-header-anchor '></a>[Python] Redis 使用</h2><blockquote><p><strong>环境：</strong>Python 2.7.14</p></blockquote><blockquote><p><strong>安装 redis：</strong>pip install redis <em>redis</em>-py-cluster</p></blockquote><blockquote><p><strong>源码：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/redis_helper.py'>点此下载</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n270" mdtype="fences" style="break-inside: unset;"># -*- coding:utf-8 -*-
import datetime
import time


class RedisHelper(object):
    def __init__(self, redis_type=None, **args):
        if redis_type == "cluster":
            import rediscluster
            self.r_conn = rediscluster.StrictRedisCluster(**args)
        else:
            import redis
            self.r_conn = redis.StrictRedis(**args)

    def GetValue(self, name):
        return self.r_conn.get(name)

    def IncrValue(self, name):
        return self.r_conn.incr(name)

    def SetValue(self, name, value):
        self.r_conn.set(name, value)

    def GetSetValue(self, name, value):
        return self.r_conn.getset(name, value)


if __name__ == '__main__':

    # 单点
    conn_dict = {'host': '127.0.0.1', 'port': 6379}
    redis_type = 'single'

    # 集群
    # conn_dict={"startup_nodes":[
    #    {'host':'192.168.0.3', 'port':4000},
    #    {'host':'192.168.0.3', 'port':5000},
    #    {'host':'192.168.0.4', 'port':6000},
    #    {'host':'192.168.0.5', 'port':7000}]}
    # redis_type='cluster'

    myredis = RedisHelper(redis_type, **conn_dict)
    print(myredis.SetValue('name', 'kevin'))
    print(myredis.GetValue('name'))
    print(myredis.GetSetValue('nickname', 0))
    print(myredis.GetValue('nickname'))

</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n272" mdtype="fences">None
kevin
0
0
</pre><h2><a name='header-n273' class='md-header-anchor '></a>[Python] MySQL 使用</h2><blockquote><p><strong>环境：</strong>Python 2.7.14</p></blockquote><blockquote><p><strong>源码：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/mysql_helper.py'>点此下载</a></p></blockquote><blockquote><p><strong>Tag：</strong>查询、批量插入、truncate</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n280" mdtype="fences" style="break-inside: unset;"># coding=utf-8
import sys
import time
import datetime
import logging
import MySQLdb
import MySQLdb.cursors

logger = logging.getLogger("latest_active_user")
logger.setLevel(logging.DEBUG)

# user_tbl
user_tbl = {
    "host": "10.10.10.10",
    "port": 3306,
    "user": "lsb",
    "passwd": "lsb",
    "db": "db"
}

latest_active_user = {
    "host": "10.10.10.10",
    "port": 3306,
    "user": "lsb",
    "passwd": "lsb",
    "db": "db"
}

# push_stat_{}
push_stat = {
    "host": "10.10.10.10",
    "port": 4000,
    "user": "lsb",
    "passwd": "lsb",
    "db": "db"
}

# user_register_{}
user_register = {
    "host": "10.10.10.10",
    "port": 3306,
    "user": "lsb",
    "passwd": "lsb",
    "db": "db"
}

# user_action_log_{}
user_action_log = {
    "host": "10.10.10.10",
    "port": 3306,
    "user": "lsb",
    "passwd": "lsb",
    "db": "db"
}

user_id_set = set()


def format_date(diff_days):
    date_time = datetime.datetime.utcnow() + datetime.timedelta(hours=7)
    return (date_time + datetime.timedelta(days=diff_days)).strftime("%Y%m%d")


def init_logger(log_module):
    handler = logging.FileHandler(filename="latest_active_user.log", mode='w')
    # handler.setLevel(logging.DEBUG)
    formatter = logging.Formatter("%(asctime)s - %(levelname)s - %(message)s")
    handler.setFormatter(formatter)
    log_module.addHandler(handler)


def get_db_conn(mysql_config):
    db = MySQLdb.connect(host=mysql_config['host'],
                         port=mysql_config['port'],
                         user=mysql_config['user'],
                         passwd=mysql_config['passwd'],
                         db=mysql_config['db'],
                         cursorclass=MySQLdb.cursors.DictCursor)
    db.set_character_set('utf8mb4')
    cursor = db.cursor()
    cursor.execute('SET NAMES utf8mb4;')

    return db, cursor


def truncate_table_helper():
    sql = "truncate table `db`.`latest_active_user_tbl`"
    logger.debug("database: %s, sql: %s", latest_active_user_tbl, sql)
    db, cursor = get_db_conn(latest_active_user)
    cursor.execute(sql)
    db.commit()
    cursor.close()
    db.close()


def fetch_helper(conn, sql):
    logger.debug("database: %s, sql: %s", conn, sql)
    db, cursor = get_db_conn(conn)
    cursor.execute(sql)
    ret = cursor.fetchall()
    cursor.close()
    db.close()
    if not ret:
        logger.warn("sql not ret")
    return ret


def batch_insert_helper(user_id_set):
    if len(user_id_set) == 0:
        return
    total = 0
    try:

        db, cursor = get_db_conn(latest_active_user)
        batch = 100000
        values = []

        for i in user_id_set:
            values.append((i,))
            # 批量插入
            if len(values) == batch:
                total += batch
                logger.info("batch insert, count: %d", len(values))
                cursor.executemany(
                    'INSERT INTO `db`.`latest_active_user_tbl` (user_id) VALUES (%s)', values)
                db.commit()
                values = []

        if len(values) &gt; 0:
            total += len(values)
            logger.info("final batch insert, count: %d", len(values))
            cursor.executemany(
                'INSERT INTO `db`.`latest_active_user_tbl` (user_id) VALUES (%s)', values)
            db.commit()
            values = []

        cursor.close()
        db.close()
    except MySQLdb.Error as ex:
        logger.error("MySQL Error %d: %s", ex.args[0], ex.args[1])

    return total


def from_push_stat():
    sql = """
    select distinct(user_id) from `db`.`push_stat_{}`
    union select distinct(user_id) from `db`.`push_stat_{}`
    union select distinct(user_id) from `db`.`push_stat_{}`
    union select distinct(user_id) from `db`.`push_stat_{}`
    union select distinct(user_id) from `db`.`push_stat_{}`
    union select distinct(user_id) from `db`.`push_stat_{}`
    union select distinct(user_id) from `db`.`push_stat_{}`
    """.format(format_date(-1), format_date(-2), format_date(-3), format_date(-4),
               format_date(-5), format_date(-6), format_date(-7))
    users = fetch_helper(push_stat, sql)
    if not users:
        logger.info("call fetch_helper(), no record")
    else:
        logger.info("call fetch_helper(), got %d record(s)", len(users))
        for row in users:
            user_id_set.add(row['user_id'])


def from_user():
    sql = """
    select id from `db`.`user_tbl`
    where create_time &gt; date_add(now(), interval - 7 day)
    """
    users = fetch_helper(user, sql)
    if not users:
        logger.info("call fetch_helper(), no record")
    else:
        logger.info("call fetch_helper(), got %d record(s)", len(users))
        for row in users:
            user_id_set.add(row['id'])


def from_user_register():
    sql = """
    select distinct(user_id) from `db`.`user_register_{}`
    union select distinct(user_id) from `db`.`user_register_{}`
    union select distinct(user_id) from `db`.`user_register_{}`
    """.format(format_date(-1), format_date(-2), format_date(-3))
    users = fetch_helper(user_register, sql)
    if not users:
        logger.info("call fetch_helper(), no record")
    else:
        logger.info("call fetch_helper(), got %d record(s)", len(users))
        for row in users:
            user_id_set.add(row['user_id'])


def from_user_action_log():
    sql = """
    select distinct(user_id) from `db`.`user_action_log_{}`
    union select distinct(user_id) from `db`.`user_action_log_{}`
    union select distinct(user_id) from `db`.`user_action_log_{}`
    """.format(format_date(-1), format_date(-2), format_date(-3))
    users = fetch_helper(user_action_log, sql)
    if not users:
        logger.info("call fetch_helper(), no record")
    else:
        logger.info("call fetch_helper(), got %d record(s)", len(users))
        for row in users:
            user_id_set.add(row['user_id'])


if __name__ == '__main__':
    init_logger(logger)

    logger.info("begin task")

    # 清空表
    truncate_table_helper()

    # 清洗数据
    from_push_stat()
    logger.info("after from_push_stat(), size: %d", len(user_id_set))
    from_user()
    logger.info("after from_user(), size: %d", len(user_id_set))
    from_user_register()
    logger.info("after from_user_register(), size: %d", len(user_id_set))
    from_user_action_log()
    logger.info("after from_user_action_log(), size: %d", len(user_id_set))

    # 批量插入数据
    batch_insert_helper(user_id_set)

    logger.info("end task")
</pre><h2><a name='header-n281' class='md-header-anchor '></a>[Python] kafka 使用</h2><blockquote><p><strong>环境：</strong>Python 2.7.14/kafka-python 1.4.2</p></blockquote><blockquote><p><strong>源码：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/kafka_consumer.py'>kafka_consumer.py</a>、<a href='https://dudebing99.github.io/Blog/archives/code_snippet/kafka_producer.py'>kafka_producer.py</a></p></blockquote><blockquote><p><strong>Tag：</strong>kafka 生产者、消费者</p></blockquote><blockquote><p><strong>参考：</strong><a href='http://kafka-python.readthedocs.io/en/master/usage.html' target='_blank' class='url'>http://kafka-python.readthedocs.io/en/master/usage.html</a></p></blockquote><h3><a name='header-n290' class='md-header-anchor '></a>消费者</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n291" mdtype="fences" style="break-inside: unset;">from kafka import KafkaConsumer

def consume():
    # To consume latest messages and auto-commit offsets
    consumer = KafkaConsumer('test',
                             group_id='test-group',
                             bootstrap_servers=['192.168.2.99:9092'],
                             api_version=(0, 10))
    for message in consumer:
        # message value and key are raw bytes -- decode if necessary!
        # e.g., for unicode: `message.value.decode('utf-8')`
        print("%s:%d:%d: key=%s value=%s" % (message.topic, message.partition,
                                              message.offset, message.key,
                                              message.value))


if __name__ == '__main__':
    consume()
</pre><h3><a name='header-n292' class='md-header-anchor '></a>生产者</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n293" mdtype="fences" style="break-inside: unset;">from kafka import KafkaProducer
from kafka.errors import KafkaError
import json
import sys

def on_send_success(record_metadata):
    print(record_metadata.topic, record_metadata.partition, record_metadata.offset)

def on_send_error(excp):
    print('I am an errback', str(exc_info=excp))
    # handle exception

producer = KafkaProducer(bootstrap_servers=['192.168.2.99:9092'],
                         api_version=(0, 10),
                         max_block_ms=10000,
                         retries=2)

def produce():
    for i in range(3):
        message = {
            'id': i,
            'msg': 'hello world',
        }
        # produce asynchronously with callbacks
        # produce keyed messages to enable hashed partitioning
        producer.send('test', key='bingo', value=json.dumps(message)).add_callback(
            on_send_success).add_errback(on_send_error)
        # un-keyed messages
        producer.send('test', json.dumps(message)).add_callback(on_send_success).add_errback(
            on_send_error)

    # block until all async messages are sent
    producer.flush()

if __name__ == '__main__':
    produce()
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n295" mdtype="fences">$ python kafka_producer.py
('test', 0, 132)
('test', 0, 133)
('test', 0, 134)
('test', 0, 135)
('test', 0, 136)
('test', 0, 137)
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n296" mdtype="fences">$ python kafka_consumer.py
test:0:132: key=bingo value={"msg": "hello world", "id": 0}
test:0:133: key=None value={"msg": "hello world", "id": 0}
test:0:134: key=bingo value={"msg": "hello world", "id": 1}
test:0:135: key=None value={"msg": "hello world", "id": 1}
test:0:136: key=bingo value={"msg": "hello world", "id": 2}
test:0:137: key=None value={"msg": "hello world", "id": 2}
</pre><h2><a name='header-n297' class='md-header-anchor '></a>[Python] YAML 配置文件</h2><blockquote><p><strong>环境：</strong>Python 2.7.14/PyYAML 3.12</p></blockquote><blockquote><p><strong>依赖库：</strong>pip install pyyaml</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n302" mdtype="fences" style="break-inside: unset;"># coding: utf8

import os
import yaml
import time
from os import path


class DynFileLoader(object):
    def __init__(self, file_path, detect_interval=10):
        if not path.exists(file_path):
            raise IOError('{} not existed'.format(file_path))

        self._detect_interval = detect_interval
        self._file_path = file_path
        self._file_last_mtime = None
        self._file_content = None
        self._file_last_load_time = None

        self._reload()

    def _reload(self):
        with open(self._file_path) as f:
            now = int(time.time())
            self._file_content = f.read()
            self._file_last_mtime = now
            self._file_last_load_time = now

    def _is_file_modified(self):
        return path.getmtime(self._file_path) &gt; self._file_last_mtime

    def _should_reload(self):
        now = int(time.time())
        if now - self._file_last_load_time &gt; self._detect_interval:
            return self._is_file_modified()
        else:
            return False

    def get_content(self):
        if self._should_reload():
            self._reload()

        return self._file_content


class DynYamlConfig(DynFileLoader):
    def __init__(self, file_path, detect_interval=10):
        self._yaml_map = {}
        DynFileLoader.__init__(self, file_path, detect_interval)

    def _reload(self):
        with open(self._file_path) as f:
            now = int(time.time())
            self._yaml_map = yaml.safe_load(f)
            self._file_last_mtime = now
            self._file_last_load_time = now

    def get_content(self):
        if self._should_reload():
            self._reload()
        return self._yaml_map

    def get_value(self, key, default=None):
        config = self.get_content()

        if not config:
            return default

        return config.get(key, default)

if __name__ == '__main__':
    conf = DynYamlConfig('dummy.yml')

    content = conf.get_content()
    print(content)

    item = conf.get_value("product")['item']
    print(item)

    numbers = conf.get_value("numbers")
    print(numbers)

    item = conf.get_value("food")['fruit']['item']
    print(item)
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n304" mdtype="fences">{'food': {'fruit': {'item': 'apple'}}, 'product': {'item': 'hello'}, 'numbers': [1, 2, 3, 4]}
hello
[1, 2, 3, 4]
apple
</pre><h2><a name='header-n305' class='md-header-anchor '></a>[Python] HTTP GET/POST 请求</h2><h3><a name='header-n306' class='md-header-anchor '></a>urllib2</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n307" mdtype="fences" style="break-inside: unset;"># coding = utf-8
import urllib2
import json
import sys
reload(sys)
sys.setdefaultencoding('utf-8')


def get(url):
    resp = urllib2.urlopen(url=url, timeout=10)
    return resp.read()


def post(url, data):
    resp = urllib2.urlopen(url=url, data=data, timeout=10)
    return resp.read()


if __name__ == '__main__':
    data1 = get('http://45.77.40.154:9999/admin_stat/product')
    print(data1)

    payload = {
        'product': 'ahihi'
    }
    data2 = post('http://45.77.40.154:9999/admin_stat/category',
                 json.dumps(payload))
    print(data2)
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n309" mdtype="fences">{"message": "success", "data": [{"name": "\u5934\u6761\u4ea7\u54c1", "value": "lsb"}, {"name": "\u5c0f\u8bf4\u6f2b\u753b", "value": "ahihi"}]}

{"message": "success", "data": [{"description": "total product data", "children": [], "name": "\u4ea7\u54c1\u603b\u4f53\u6570\u636e",
"data_cat": "total_product_data,"}]}
</pre><h3><a name='header-n310' class='md-header-anchor '></a>requests</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n311" mdtype="fences" style="break-inside: unset;"># coding = utf-8
import requests
import sys
import json
reload(sys)
sys.setdefaultencoding('utf-8')

RETRY_TIMES = 1
REQUEST_TIMEOUT = 3

http_session = requests.Session()


def common_request(url, payload):
    retry_times = 0
    resp = None
    while retry_times &lt; RETRY_TIMES:
        try:
            resp = http_session.post(
                url, data=json.dumps(payload), timeout=REQUEST_TIMEOUT)
            break
        except Exception as ex:
            print("common_request post error: %s, url=%s" % (ex, url))
            retry_times += 1

    if (resp is not None) and (resp.status_code == 200):
        r = resp.json()
        result = r.get('data', {})
        print("return resp result_len=%d" % (len(result)))
        return result
    else:
        print("common_request post error! url=%s, payload=%s" % (url, payload))
        return None


if __name__ == '__main__':
    r = requests.get('http://45.77.40.154:9999/admin_stat/product')
    print(r.content)

    payload = {'product': 'ahihi'}
    r = requests.post('http://45.77.40.154:9999/admin_stat/category',
                      json.dumps(payload))
    print('URL: ', r.url)
    print('HEADERS: ', r.headers)
    print('Content-Type: ', r.headers.get('content-type'))
    print('CODE: ', r.status_code)
    print(r.content)

    result = common_request('http://45.77.40.154:9999/admin_stat/category',
                            payload)
    print(result)
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n313" mdtype="fences">{"message": "success", "data": [{"name": "\u5934\u6761\u53f7\u4f5c\u8005", "value": "top_author"}, {"name": "\u5934\u6761\u4ea7\u54c1", "value": "lsb"}, {"name": "\u5c0f\u8bf4\u6f2b\u753b", "value": "novel&amp;comic"}]}

('URL: ', u'http://45.77.40.154:9999/admin_stat/category')
('HEADERS: ', {'Date': 'Tue, 29 May 2018 03:29:47 GMT', 'Content-Length': '171', 'Content-Type': 'application/json', 'Server': 'Werkzeug/0.12.2 Python/2.7.5'})
('Content-Type: ', 'application/json')
('CODE: ', 200)
{"message": "success", "data": [{"description": "total product data", "children": [], "name": "\u4ea7\u54c1\u603b\u4f53\u6570\u636e",
"data_cat": "total_product_data,"}]}

return resp result_len=1
[{u'data_cat': u'total_product_data,', u'description': u'total product data', u'name': u'\u4ea7\u54c1\u603b\u4f53\u6570\u636e', u'children': []}]
</pre><h2><a name='header-n314' class='md-header-anchor '></a>[Python] Flask RESTful</h2><blockquote><p><strong>环境：</strong>Python 2.7.14/Flask 0.11.1/Flask-RESTful 0.3.5/Flask-SQLAlchemy 2.2</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n317" mdtype="fences" style="break-inside: unset;"># -*- coding:utf-8 -*-
from flask import Flask
from flask_restful import Api
from flask_restful import Resource

import os
import sys
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))
reload(sys)
sys.setdefaultencoding('utf-8')

class IndexView(Resource):
    def post(self):
        return {'message': 'error! please use http get'}

    def get(self):
        return {'message': 'hello world'}

if __name__ == '__main__':
    app = Flask(__name__)
    api = Api(app)
    api.add_resource(IndexView, '/index')

    app.run(host='0.0.0.0', port=12345, debug=True)
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n319" mdtype="fences">[root@~]# python app.py
 * Running on http://0.0.0.0:12345/ (Press CTRL+C to quit)
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 293-571-458
127.0.0.1 - - [25/May/2018 09:34:49] "GET /index HTTP/1.1" 200 -
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bah" contenteditable="false" cid="n320" mdtype="fences">[root@~]# curl http://0.0.0.0:12345/index
{
    "message": "hello world"
}
</pre><h2><a name='header-n321' class='md-header-anchor '></a>[Python] WSGI 服务器以及中间件</h2><blockquote><p><strong>环境：</strong>Python 2.7.4</p></blockquote><blockquote><p><strong>源码：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/wsgi_server.py'>点此下载</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n326" mdtype="fences" style="break-inside: unset;">from wsgiref.simple_server import make_server

URL_PATTERNS = (
    ('hi/', 'say_hi'),
    ('hello/', 'say_hello'),
)


# 自定义中间件
class Dispatcher(object):
    def _match(self, path):
        path = path.split('/')[1]
        for url, app in URL_PATTERNS:
            if path in url:
                return app

    def __call__(self, environ, start_response):
        path = environ.get('PATH_INFO', '/')
        app = self._match(path)
        if app:
            app = globals()[app]
            return app(environ, start_response)
        else:
            start_response("404 NOT FOUND", [('Content-type', 'text/plain')])
            return ["Not Found!"]


def say_hi(environ, start_response):
    start_response("200 OK", [('Content-type', 'text/html')])
    return ["Hi!"]


def say_hello(environ, start_response):
    start_response("200 OK", [('Content-type', 'text/html')])
    return ["Hello!"]


app = Dispatcher()

httpd = make_server('', 8000, app)
print "Serving on port 8000..."
httpd.serve_forever()
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bah" contenteditable="false" cid="n328" mdtype="fences">Serving on port 8000...
('middleware, uri: ', '/hi')
127.0.0.1 - - [28/May/2018 00:06:03] "GET /hi HTTP/1.1" 200 3
('middleware, uri: ', '/hello')
127.0.0.1 - - [28/May/2018 00:06:07] "GET /hello HTTP/1.1" 200 6
('middleware, uri: ', '/haha')
127.0.0.1 - - [28/May/2018 00:06:15] "GET /haha HTTP/1.1" 404 10
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n329" mdtype="fences">$ curl http://127.0.0.1:8000/hi -s
Hi!
$ curl http://127.0.0.1:8000/hello -s
Hello!
$ curl http://127.0.0.1:8000/haha -s
Not Found!
</pre><h2><a name='header-n330' class='md-header-anchor '></a>[Python] 微信报警</h2><blockquote><p><strong>环境：</strong>Python 2.7.14</p></blockquote><blockquote><p><strong>源码：</strong><a href='https://dudebing99.github.io/Blog/archives/code_snippet/wechat_alarm.py'>点此下载</a></p></blockquote><blockquote><p><strong>功能：</strong>将服务异常信息通过微信企业号 api 发送给运维员工企业微信</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n337" mdtype="fences" style="break-inside: unset;"># coding = utf-8
import urllib2
import copy
import time
import json
import sys
import getopt

ACCESS_TOKEN_URL = "https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=wx290fabd94076dd5f&amp;corpsecret=aHg0UnTDcnkQKw8sqqejxrBLPksuvauedrvOoaF0l2Q"
SEND_MESSAGE_URL = "https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token="
MSG_TEMPLATE = {
    "msgtype": "text",
    "agentid": 1,
    "text": {
        "content": "no message set"
    },
    "safe": 0
}


class Wechat(object):

    def __init__(self):
        self.last_get_token_time = 0
        self.token_expire = 0
        self.token = None

    def _get(self, url):
        resp = urllib2.urlopen(url=url, timeout=10)
        return resp.read()

    def _post(self, url, data):
        resp = urllib2.urlopen(url=url, data=data, timeout=10)
        return resp.read()

    def _get_access_token(self):
        data = self._get(ACCESS_TOKEN_URL)
        if data == None:
            print("request wechat server falied")
            return

        resp = json.loads(data)
        if resp == None:
            print("request wechat server falied")
        if resp["errcode"] == 0:
            self.token = resp["access_token"]
            self.last_get_token_time = int(time.time())
            self.token_expire = resp["expires_in"]
        else:
            print("get wechat access token error, msg: %s", resp["errmsg"])

    def send_message(self, toparty=None, touser=None, msg="no msg set"):
        if not self.is_token_valid():
            self._get_access_token()
        body = copy.deepcopy(MSG_TEMPLATE)
        text = body.setdefault("text", {})
        text["content"] = msg

        if toparty != None:
            body["toparty"] = toparty

        if touser != None:
            body["touser"] = touser

        url = SEND_MESSAGE_URL + self.token
        data = self._post(url, json.dumps(body))
        if data == None:
            print("request wechat server falied")
            return
        resp = json.loads(data)
        if resp == None:
            print("request wechat server falied")
        elif resp["errcode"] != 0:
            print("get wechat access token error, msg: %s", resp["errmsg"])
        else:
            pass

    def is_token_valid(self):
        if self.token == None:
            return False
        elif (int(time.time()) - self.last_get_token_time) &gt; (self.token_expire - 100):
            return False
        else:
            return True


wechat = Wechat()


def notify(userids, message):
    if userids is None:
        notify_all(message)
    else:
        notify_user(userids, message)


def notify_all(message):
    wechat.send_message(toparty="2", msg=message)


def notify_user(userids, message):
    users = "|".join(userids)
    wechat.send_message(touser=users, msg=message)


def send_message(msg):
    wechat.send_message(msg)


def usage(e):
    print "python wechat_alter.py -m \"test message\" -u \"lvfei,XieJianHe\""
    if e != None:
        print str(e)


if __name__ == '__main__':

    try:
        opts, args = getopt.getopt(sys.argv[1:], "m:u:")
        message = None
        users = None
        for op, value in opts:
            if op == "-m":
                message = value
            elif op == "-u":
                users = value.split(",")
            else:
                usage(None)
                sys.exit()
        if message == None:
            raise Exception("-m must be setted")
        if users != None:
            notify_user(users, message)
        else:
            notify_all(message)
        print "Message send success"
    except Exception, e:
        usage(e)
        sys.exit()
</pre><h2><a name='header-n338' class='md-header-anchor '></a>[Python] IP 定位</h2><blockquote><p>对于客户端使用代理，按照代理 IP 进行处理。服务端获取客户端 IP，使用 <code>www.ip.cn</code> 提供的 IP 定位服务获取客户端接入的位置信息。</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n341" mdtype="fences" style="break-inside: unset;"># -*- coding:utf-8 -*-
from flask_restful import Resource
from flask import request
from common.common import logger
import common.db_utility as db_utility
import json
from bs4 import BeautifulSoup
import requests


def get_ip_info(ip):
    url = 'http://www.ip.cn/index.php?ip={0}'.format(ip)
    headers = {
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
        'Accept-Encoding': 'gzip, deflate, sdch',
        'Accept-Language': 'zh-CN,zh;q=0.8,en;q=0.6',
        'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36',
        'Referer': 'http://www.ip.cn/',
        'Connection': 'keep-alive',
        'Host': 'www.ip.cn',
    }
    data = {}
    try:
        r = requests.get(url, headers=headers, timeout=30)
        soup = BeautifulSoup(r.content, "html.parser")
        s = soup.find(name='div', attrs={"id": "result"})
        data['errorcode'] = 0
        data['errormsg'] = 'acquire location info success'
        data['ip'] = s.find_all(name="code")[0].get_text()
        data['location'] = s.find_all(name="code")[1].get_text()
    except Exception as e:
        logger.error(e)
        data['errorcode'] = 0
        data['errormsg'] = 'acquire location info failed'
    logger.debug("client location info: %s", data)
    return data


class TestView(Resource):
    def post(self):
        ip = request.headers.getlist(
            "X-Forwarded-For")[0] if request.headers.getlist("X-Forwarded-For") else request.remote.addr
        logger.debug("client address: %s, visit: %s", ip, request.base_url)
        return get_ip_info(ip)

    def get(self):
        ip = request.headers.getlist(
            "X-Forwarded-For")[0] if request.headers.getlist("X-Forwarded-For") else request.remote.addr
        logger.debug("client address: %s, visit: %s", ip, request.base_url)
        return get_ip_info(ip)
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n343" mdtype="fences">{
    "errorcode": 0,
    "errormsg": "acquire location info success",
    "location": "广东省深圳市 联通",
    "ip": "163.125.210.209"
}
</pre><p>如果使用美国代理，输出如下</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n345" mdtype="fences">{
    "errorcode": 0,
    "errormsg": "acquire location info success",
    "location": "美国 ",
    "ip": "45.62.102.71"
}
</pre><h2><a name='header-n346' class='md-header-anchor '></a>[Lua] 求最大值</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="lua" contenteditable="false" cid="n347" mdtype="fences" style="break-inside: unset;">function maximum(a)
    local mi = 1        -- maximum index
    local mv = a[mi]    -- maximum value

    for i, val in ipairs(a) do
        if val &gt; mv then
            mi = i
            mv = val
        end
    end

    return mi, mv
end

print(maximum({12, 99, 28, 49, 92, 5}))
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n349" mdtype="fences">2       99
</pre><h2><a name='header-n350' class='md-header-anchor '></a>[Lua] 解包 unpack</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="lua" contenteditable="false" cid="n351" mdtype="fences" style="break-inside: unset;">function unpack(t, i)
    i = i or 1

    if t[i] ~= nil then
        return t[i], unpack(t, i + 1)
    end
end

local t = {'h', 'e', 'l', 'l', 'o'}

print(unpack(t))

local t2 = {unpack(t, 3)}

for i, v in ipairs(t2) do
    print(i, v)
end
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n353" mdtype="fences">h       e       l       l       o
1       l
2       l
3       o
</pre><h2><a name='header-n354' class='md-header-anchor '></a>[Lua] 不定参数与格式化</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="lua" contenteditable="false" cid="n355" mdtype="fences">function fwrite(fmt, ...)
    return io.write(string.format(fmt, unpack(arg)))
end

fwrite("greetings: %s\n", "hello")
fwrite("%s, %s%d\n", "hello", "dudebing", 99)
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n357" mdtype="fences">greetings: hello
hello, dudebing99
</pre><h2><a name='header-n358' class='md-header-anchor '></a>[Solidity] 以太坊合约示例：hello world</h2><p>Solidity 合约脚本如下，<a href='https://dudebing99.github.io/Blog/archives/solidity/hello_world.sol'>点此下载</a></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n360" mdtype="fences" style="break-inside: unset;">pragma solidity ^0.4.11;

contract HelloWorld
{
    address creator;
    string greeting;

    constructor(string _greeting) public
    {
        creator = msg.sender;
        greeting = _greeting;
    }

    function greet() public view returns (string)
    {
        return greeting;
    }

    function setGreeting(string _newgreeting) public
    {
        greeting = _newgreeting;
    }

    // Standard kill() function to recover funds
    function kill() public
    {
        if (msg.sender == creator)
        {
            // kills this contract and sends remaining funds back to creator
            selfdestruct(creator);
        }
    }
}
</pre><p>使用 SolC 编译上述脚本</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n362" mdtype="fences">root:ethereum# solc --optimize --abi --bin helloworld.sol

======= helloworld.sol:HelloWorld =======
Binary:
608060405234801561001057600080fd5b5060405161040038038061040083398101604052805160008054600160a060020a0319163317905501805161004c906001906020840190610053565b50506100ee565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061009457805160ff19168380011785556100c1565b828001600101855582156100c1579182015b828111156100c15782518255916020019190600101906100a6565b506100cd9291506100d1565b5090565b6100eb91905b808211156100cd57600081556001016100d7565b90565b610303806100fd6000396000f3006080604052600436106100565763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b5811461005b578063a413686214610072578063cfae3217146100cb575b600080fd5b34801561006757600080fd5b50610070610155565b005b34801561007e57600080fd5b506040805160206004803580820135601f81018490048402850184019095528484526100709436949293602493928401919081908401838280828437509497506101929650505050505050565b3480156100d757600080fd5b506100e06101a9565b6040805160208082528351818301528351919283929083019185019080838360005b8381101561011a578181015183820152602001610102565b50505050905090810190601f1680156101475780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b60005473ffffffffffffffffffffffffffffffffffffffff163314156101905760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b80516101a590600190602084019061023f565b5050565b60018054604080516020601f600260001961010087891615020190951694909404938401819004810282018101909252828152606093909290918301828280156102345780601f1061020957610100808354040283529160200191610234565b820191906000526020600020905b81548152906001019060200180831161021757829003601f168201915b505050505090505b90565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061028057805160ff19168380011785556102ad565b828001600101855582156102ad579182015b828111156102ad578251825591602001919060010190610292565b506102b99291506102bd565b5090565b61023c91905b808211156102b957600081556001016102c35600a165627a7a72305820565e009caf97424b1c531eba83ef96d9242a835ead6e7f9fdffd963ef1d6213d0029
Contract JSON ABI
[{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_newgreeting","type":"string"}],"name":"setGreeting","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"greet","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_greeting","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]
</pre><p>调用合约的 js 脚本【同步】，<a href='https://dudebing99.github.io/Blog/archives/solidity/hello_world.js'>点此下载</a></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="js" contenteditable="false" cid="n364" mdtype="fences" style="break-inside: unset;">let Web3 = require('web3');
let web3;

if (typeof web3 !== 'undefined') {
    web3 = new Web3(web3.currentProvider);
} else {
    // set the provider you want from Web3.providers
    web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
}

abi =
[{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_newgreeting","type":"string"}],"name":"setGreeting","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"greet","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_greeting","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}];

hex =
"0x608060405234801561001057600080fd5b5060405161040038038061040083398101604052805160008054600160a060020a0319163317905501805161004c906001906020840190610053565b50506100ee565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061009457805160ff19168380011785556100c1565b828001600101855582156100c1579182015b828111156100c15782518255916020019190600101906100a6565b506100cd9291506100d1565b5090565b6100eb91905b808211156100cd57600081556001016100d7565b90565b610303806100fd6000396000f3006080604052600436106100565763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166341c0e1b5811461005b578063a413686214610072578063cfae3217146100cb575b600080fd5b34801561006757600080fd5b50610070610155565b005b34801561007e57600080fd5b506040805160206004803580820135601f81018490048402850184019095528484526100709436949293602493928401919081908401838280828437509497506101929650505050505050565b3480156100d757600080fd5b506100e06101a9565b6040805160208082528351818301528351919283929083019185019080838360005b8381101561011a578181015183820152602001610102565b50505050905090810190601f1680156101475780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b60005473ffffffffffffffffffffffffffffffffffffffff163314156101905760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b80516101a590600190602084019061023f565b5050565b60018054604080516020601f600260001961010087891615020190951694909404938401819004810282018101909252828152606093909290918301828280156102345780601f1061020957610100808354040283529160200191610234565b820191906000526020600020905b81548152906001019060200180831161021757829003601f168201915b505050505090505b90565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061028057805160ff19168380011785556102ad565b828001600101855582156102ad579182015b828111156102ad578251825591602001919060010190610292565b506102b99291506102bd565b5090565b61023c91905b808211156102b957600081556001016102c35600a165627a7a72305820565e009caf97424b1c531eba83ef96d9242a835ead6e7f9fdffd963ef1d6213d0029";

helloworldContract = web3.eth.contract(abi);

helloworld = helloworldContract.new('hello world', {from:web3.eth.accounts[0], data:hex, gas:3000000});
//console.log(helloworld);

recpt = web3.eth.getTransactionReceipt(helloworld.transactionHash);
//console.log(recpt);

contract_ = helloworldContract.at(recpt.contractAddress);
//console.log(contract_);

console.log(contract_.greet.call());

// 调用 setGreeting()，修改问候语
//contract_.setGreeting.sendTransaction('bala bala', {from:web3.eth.accounts[0], gas:3000000})
//console.log(contract_.greet.call());

process.exit(0);
</pre><p>调用合约的 js 脚本【异步】，<a href='https://dudebing99.github.io/Blog/archives/solidity/hello_world2.js'>点此下载</a></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n366" mdtype="fences" style="break-inside: unset;">let Web3 = require('web3');
let web3;

if (typeof web3 !== 'undefined') {
    web3 = new Web3(web3.currentProvider);
} else {
    // set the provider you want from Web3.providers
    web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
}

var _greeting = 'hello world' ;
var helloworldContract =
web3.eth.contract([{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_newgreeting","type":"string"}],"name":"setGreeting","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"greet","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_greeting","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]);
var helloworld = helloworldContract.new(
   _greeting,
   {
     from: web3.eth.accounts[3],
     data:
'0x608060405234801561001057600080fd5b506040516104ce3803806104ce83398101806040528101908080518201929190505050336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508060019080519060200190610089929190610090565b5050610135565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100d157805160ff19168380011785556100ff565b828001600101855582156100ff579182015b828111156100fe5782518255916020019190600101906100e3565b5b50905061010c9190610110565b5090565b61013291905b8082111561012e576000816000905550600101610116565b5090565b90565b61038a806101446000396000f300608060405260043610610057576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806341c0e1b51461005c578063a413686214610073578063cfae3217146100dc575b600080fd5b34801561006857600080fd5b5061007161016c565b005b34801561007f57600080fd5b506100da600480360381019080803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506101fd565b005b3480156100e857600080fd5b506100f1610217565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610131578082015181840152602081019050610116565b50505050905090810190601f16801561015e5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156101fb576000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b565b80600190805190602001906102139291906102b9565b5050565b606060018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102af5780601f10610284576101008083540402835291602001916102af565b820191906000526020600020905b81548152906001019060200180831161029257829003601f168201915b5050505050905090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106102fa57805160ff1916838001178555610328565b82800160010185558215610328579182015b8281111561032757825182559160200191906001019061030c565b5b5090506103359190610339565b5090565b61035b91905b8082111561035757600081600090555060010161033f565b5090565b905600a165627a7a72305820a1f05e91173cc950667daa14733bd379c766ea83112228e1951b7a52b68498bd0029',
     gas: '3000000'
   }, function (e, contract){

    recpt = web3.eth.getTransactionReceipt(contract.transactionHash);
    contract_ = helloworldContract.at(recpt.contractAddress);

    console.log(contract_.greet.call());

    //contract_.setGreeting.sendTransaction('bala bala', {from:web3.eth.accounts[0], gas:3000000})
    //console.log(samplecontract.greet.call());

    process.exit(0);
 })
</pre><p>&nbsp;</p><p>调用 node 执行脚本</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n369" mdtype="fences">root:ethereum# node helloworld.js
hello world
</pre><h2><a name='header-n370' class='md-header-anchor '></a>[Solidity] 以太坊合约示例：存储</h2><p>Solidity 合约脚本如下，<a href='https://dudebing99.github.io/Blog/archives/solidity/sample.sol'>点此下载</a></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n372" mdtype="fences" style="break-inside: unset;">pragma solidity ^0.4.11;

contract Sample {

    uint public value;

    constructor(uint v) public {
        value = v;
    }

    function set(uint v) public {
        value = v;
    }

    function get() public view returns (uint) {
        return value;
    }
}
</pre><p>使用 SolC 编译上述脚本</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n374" mdtype="fences">root:ethereum# solc --optimize --abi --bin sample.sol

======= sample.sol:Sample =======
Binary:
608060405234801561001057600080fd5b50604051602080610114833981016040525160005560e1806100336000396000f30060806040526004361060525763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416633fa4f2458114605757806360fe47b114607b5780636d4ce63c146092575b600080fd5b348015606257600080fd5b50606960a4565b60408051918252519081900360200190f35b348015608657600080fd5b50609060043560aa565b005b348015609d57600080fd5b50606960af565b60005481565b600055565b600054905600a165627a7a723058207098d9dc5ae86fe75d1016078954658c002f112da516ed90f64c901feb340d870029
Contract JSON ABI
[{"constant":true,"inputs":[],"name":"value","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"v","type":"uint256"}],"name":"set","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"get","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"v","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]
</pre><p>调用合约的 js 脚本，<a href='https://dudebing99.github.io/Blog/archives/solidity/sample.js'>点此下载</a></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n376" mdtype="fences" style="break-inside: unset;">let Web3 = require('web3');
let web3;

if (typeof web3 !== 'undefined') {
    web3 = new Web3(web3.currentProvider);
} else {
    // set the provider you want from Web3.providers
    web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
}

abi = [{"constant":true,"inputs":[],"name":"value","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"v","type":"uint256"}],"name":"set","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"get","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"v","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}];

hex = "0x608060405234801561001057600080fd5b50604051602080610114833981016040525160005560e1806100336000396000f30060806040526004361060525763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416633fa4f2458114605757806360fe47b114607b5780636d4ce63c146092575b600080fd5b348015606257600080fd5b50606960a4565b60408051918252519081900360200190f35b348015608657600080fd5b50609060043560aa565b005b348015609d57600080fd5b50606960af565b60005481565b600055565b600054905600a165627a7a723058207098d9dc5ae86fe75d1016078954658c002f112da516ed90f64c901feb340d870029";

sample = web3.eth.contract(abi);

thesample = sample.new(99, {from:web3.eth.accounts[0], data:hex, gas:3000000});
//console.log(thesample);

samplerecpt = web3.eth.getTransactionReceipt(thesample.transactionHash);
//console.log(samplerecpt);

samplecontract = sample.at(samplerecpt.contractAddress);
//console.log(samplecontract);

console.log(samplecontract.get.call());
console.log(samplecontract.set.sendTransaction(1001, {from:web3.eth.accounts[0], gas:3000000}));
console.log(samplecontract.get.call());

process.exit(0);
</pre><p>调用 node 执行脚本</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n378" mdtype="fences">root:ethereum# node sample.js
BigNumber { s: 1, e: 1, c: [ 99 ] }
0x0b06f2da58bd421d6db88ec2b25144491eafa5f9f53573e5783b9dd4da91c510
BigNumber { s: 1, e: 3, c: [ 1001 ] }
</pre><h2><a name='header-n379' class='md-header-anchor '></a>[Solidity] 以太坊合约示例：子货币</h2><blockquote><ul><li>合约创建者拥有铸币权，创建合约时，构造函数设置铸币者</li><li>铸币者可以调用 mint() 实现铸币</li><li>不同用户可以调用 send() 实现自货币之间的转账（转出账户余额足够即可）</li><li>可以调用 kill() 实现合约销毁，并将余额返回给铸币者</li><li>调用 watch() 监听事件，用来辅助调试、完成上层业务或记录日志</li></ul></blockquote><p>Solidity 合约脚本如下，<a href='https://dudebing99.github.io/Blog/archives/solidity/subcurrency.sol'>点此下载</a></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="basic" contenteditable="false" cid="n393" mdtype="fences" style="break-inside: unset;">pragma solidity ^0.4.21;

contract Coin {
    address public minter;
    mapping (address =&gt; uint) public balances;

    event Sent(address from, address to, uint amount);

    constructor() public {
        minter = msg.sender;
    }

    function mint(address receiver, uint amount) public {
        if (msg.sender != minter) return;
        balances[receiver] += amount;
    }

    function send(address receiver, uint amount) public {
        if (balances[msg.sender] &lt; amount) return;
        balances[msg.sender] -= amount;
        balances[receiver] += amount;
        emit Sent(msg.sender, receiver, amount);
    }

    function kill() public
    {
        if (msg.sender == minter)
        {
            // kills this contract and sends remaining funds back to creator
            selfdestruct(minter);
        }
    }
}
</pre><p>使用 SolC 编译上述脚本</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n395" mdtype="fences">root@iZwz978rorvlg75nct99l1Z:~/eth# solc --optimize --abi --bin sub_currency.sol

======= sub_currency.sol:Coin =======
Binary:
608060405234801561001057600080fd5b5060008054600160a060020a0319163317905561026b806100326000396000f30060806040526004361061006c5763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166307546172811461007157806327e235e3146100a257806340c10f19146100d557806341c0e1b5146100fb578063d0679d3414610110575b600080fd5b34801561007d57600080fd5b50610086610134565b60408051600160a060020a039092168252519081900360200190f35b3480156100ae57600080fd5b506100c3600160a060020a0360043516610143565b60408051918252519081900360200190f35b3480156100e157600080fd5b506100f9600160a060020a0360043516602435610155565b005b34801561010757600080fd5b506100f961018f565b34801561011c57600080fd5b506100f9600160a060020a03600435166024356101b2565b600054600160a060020a031681565b60016020526000908152604090205481565b600054600160a060020a0316331461016c5761018b565b600160a060020a03821660009081526001602052604090208054820190555b5050565b600054600160a060020a03163314156101b057600054600160a060020a0316ff5b565b336000908152600160205260409020548111156101ce5761018b565b33600081815260016020908152604080832080548690039055600160a060020a03861680845292819020805486019055805193845290830191909152818101839052517f3990db2d31862302a685e8086b5755072a6e2b5b780af1ee81ece35ee3cd33459181900360600190a150505600a165627a7a7230582020c3da8f368ae70ded4cf3bb492856f485bb4740c8cf4edcbee720bd34f227c90029
Contract JSON ABI
[{"constant":true,"inputs":[],"name":"minter","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balances","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"receiver","type":"address"},{"name":"amount","type":"uint256"}],"name":"mint","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"receiver","type":"address"},{"name":"amount","type":"uint256"}],"name":"send","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"address"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"Sent","type":"event"}]
</pre><p>调用合约的 js 脚本，<a href='https://dudebing99.github.io/Blog/archives/solidity/subcurrency.js'>点此下载</a></p><blockquote><p><strong>功能：</strong>铸币、转账</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n399" mdtype="fences" style="break-inside: unset;">let Web3 = require('web3');
let web3;

if (typeof web3 !== 'undefined') {
    web3 = new Web3(web3.currentProvider);
} else {
    // set the provider you want from Web3.providers
    web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
}

abi = [{"constant":true,"inputs":[],"name":"minter","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balances","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"receiver","type":"address"},{"name":"amount","type":"uint256"}],"name":"mint","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"receiver","type":"address"},{"name":"amount","type":"uint256"}],"name":"send","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"address"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"Sent","type":"event"}];

subcurrencyContract = web3.eth.contract(abi);

subcurrency = subcurrencyContract.new({from:web3.eth.accounts[0], data:hex, gas:3000000});
//console.log(subcurrency);

recpt = web3.eth.getTransactionReceipt(subcurrency.transactionHash);
//console.log(recpt);

contract_ = subcurrencyContract.at(recpt.contractAddress);
//console.log(contract_);
console.log(recpt.contractAddress);

contract_.Sent().watch(function(error, result) {
    if (!error) {
        console.log("\nCoin transfer: " + result.args.amount +
            " coins were sent from " + result.args.from +
            " to " + result.args.to + ".");
        console.log("Sender: " + contract_.balances.call(result.args.from) +
            ", Receiver: " + contract_.balances.call(result.args.to) + "\n");
    }
})

console.log("mint's hash: ", contract_.mint(web3.eth.accounts[0], 666, {from: web3.eth.accounts[0],
gas:3000000}));
console.log("minter's balance: ", contract_.balances.call(web3.eth.accounts[0]));
console.log("mint's hash ", contract_.send(web3.eth.accounts[3], 99, {from: web3.eth.accounts[0],
gas:3000000}));
console.log("minter's balance: ", contract_.balances.call(web3.eth.accounts[0]));
console.log("receiver's balance: ", contract_.balances.call(web3.eth.accounts[3]));

setTimeout(function() {
    process.exit(0);
}, 5000);
</pre><p>调用 node 执行脚本</p><blockquote><p><strong>合约地址：</strong>0x6c26a63139497d5fd5f1acbb4a35e0b0798b9fb2</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n403" mdtype="fences">root:ethereum# node subcurrency.js
0x6c26a63139497d5fd5f1acbb4a35e0b0798b9fb2
mint's hash:  0xcb51b7dd044daee96a1a2060526c848589387d42dfc070ef8b677aa2284caedd
minter's balance:  BigNumber { s: 1, e: 2, c: [ 666 ] }
mint's hash  0x2b67a507a56aaee93380a211d69a2da7349382c5d43d460badbfa2a16f835df7
minter's balance:  BigNumber { s: 1, e: 2, c: [ 567 ] }
receiver's balance:  BigNumber { s: 1, e: 1, c: [ 99 ] }

Coin transfer: 99 coins were sent from 0x2f3efd9475fb969eecfdade75a1dae02dbd92e25 to 0xc186ac87182106ff972adcc2952aae95716c9c41.
Sender: 567, Receiver: 99
</pre><p>调用合约的 js 脚本，<a href='https://dudebing99.github.io/Blog/archives/solidity/subcurrency2.js'>点此下载</a></p><blockquote><p><strong>功能：</strong>铸币、转账、销毁合约</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n407" mdtype="fences" style="break-inside: unset;">let Web3 = require('web3');
let web3;

if (typeof web3 !== 'undefined') {
    web3 = new Web3(web3.currentProvider);
} else {
    // set the provider you want from Web3.providers
    web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
}

abi = [{"constant":true,"inputs":[],"name":"minter","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balances","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"receiver","type":"address"},{"name":"amount","type":"uint256"}],"name":"mint","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"receiver","type":"address"},{"name":"amount","type":"uint256"}],"name":"send","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"address"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"Sent","type":"event"}];

subcurrencyContract = web3.eth.contract(abi);

// 根据上一个脚本运行结果获取合约地址
contract_ = subcurrencyContract.at('0x6c26a63139497d5fd5f1acbb4a35e0b0798b9fb2');
//console.log(contract_);


contract_.Sent().watch(function(error, result) {
    if (!error) {
        console.log("\nCoin transfer: " + result.args.amount +
            " coins were sent from " + result.args.from +
            " to " + result.args.to + ".");
        console.log("Sender: " + contract_.balances.call(result.args.from) +
            ", Receiver: " + contract_.balances.call(result.args.to) + "\n");
    }
})

console.log("mint's hash: ", contract_.mint(web3.eth.accounts[0], 666, {from: web3.eth.accounts[0], gas:3000000}));
console.log("minter's balance: ", contract_.balances.call(web3.eth.accounts[0]));
console.log("mint's hash ", contract_.send(web3.eth.accounts[3], 99, {from: web3.eth.accounts[0], gas:3000000}));
console.log("minter's balance: ", contract_.balances.call(web3.eth.accounts[0]));
console.log("receiver's balance: ", contract_.balances.call(web3.eth.accounts[3]));
console.log("kill's hash: ", contract_.kill({from: web3.eth.accounts[0], gas:3000000}));
console.log("minter's balance: ", contract_.balances.call(web3.eth.accounts[0]));
console.log("receiver's balance: ", contract_.balances.call(web3.eth.accounts[3]));

setTimeout(function() {
    process.exit(0);
}, 5000);
</pre><p>调用 node 执行脚本</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n409" mdtype="fences">root:ethereum# node subcurrency2.js
mint's hash:  0xaa84ad2811d2a38823ac0b5b8ea987202fe972b216a95abfe2b82b1992ed0685
minter's balance:  BigNumber { s: 1, e: 3, c: [ 1233 ] }
mint's hash  0xdc24bbda345bfd4e2a5cba4c82dabfdc0441dd4be0892ad57e5ada940339bcfe
minter's balance:  BigNumber { s: 1, e: 3, c: [ 1134 ] }
receiver's balance:  BigNumber { s: 1, e: 2, c: [ 198 ] }
kill's hash:  0xa69ff21e1774552671c7a444abe957a9ae25ae7f30e3b5ddbfcb7a6a0a6b121f
minter's balance:  BigNumber { s: 1, e: 0, c: [ 0 ] }
receiver's balance:  BigNumber { s: 1, e: 0, c: [ 0 ] }
</pre><p>销毁合约后，再次调用 node 执行脚本</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n411" mdtype="fences">mint's hash:  0xc6f64308528ffa74d585385d7553fbfc36fa514bbec577a311752e2eedc45c14
minter's balance:  BigNumber { s: 1, e: 0, c: [ 0 ] }
mint's hash  0xcf64ab8cf1096ef1b40d4982d169d5889aa529ab9e1c06a9b0a185286b1c5910
minter's balance:  BigNumber { s: 1, e: 0, c: [ 0 ] }
receiver's balance:  BigNumber { s: 1, e: 0, c: [ 0 ] }
kill's hash:  0x501f3a707bb36b1c2216f90f382ac7ec11de2277b1c200cb5fd104ca02dd2c37
minter's balance:  BigNumber { s: 1, e: 0, c: [ 0 ] }
receiver's balance:  BigNumber { s: 1, e: 0, c: [ 0 ] }
</pre><h2><a name='header-n412' class='md-header-anchor '></a>[Solidity] 以太坊合约示例：币安 Token</h2><blockquote><p><strong>参考资料：</strong><a href='https://etherscan.io/address/0xB8c77482e45F1F44dE1745F52C74426C631bDD52#code' target='_blank' class='url'>https://etherscan.io/address/0xB8c77482e45F1F44dE1745F52C74426C631bDD52#code</a></p></blockquote><p>Solidity 合约脚本如下，<a href='https://dudebing99.github.io/Blog/archives/solidity/binance_token.sol'>点此下载</a></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n416" mdtype="fences" style="break-inside: unset;">pragma solidity ^0.4.8;

/**
 * Math operations with safety checks
 */
contract SafeMath {
  function safeMul(uint256 a, uint256 b) internal returns (uint256) {
    uint256 c = a * b;
    assert(a == 0 || c / a == b);
    return c;
  }

  function safeDiv(uint256 a, uint256 b) internal returns (uint256) {
    assert(b &gt; 0);
    uint256 c = a / b;
    assert(a == b * c + a % b);
    return c;
  }

  function safeSub(uint256 a, uint256 b) internal returns (uint256) {
    assert(b &lt;= a);
    return a - b;
  }

  function safeAdd(uint256 a, uint256 b) internal returns (uint256) {
    uint256 c = a + b;
    assert(c&gt;=a &amp;&amp; c&gt;=b);
    return c;
  }

  function assert(bool assertion) internal {
    if (!assertion) {
      throw;
    }
  }
}
contract BNB is SafeMath{
    string public name;
    string public symbol;
    uint8 public decimals;
    uint256 public totalSupply;
	address public owner;

    /* This creates an array with all balances */
    mapping (address =&gt; uint256) public balanceOf;
	mapping (address =&gt; uint256) public freezeOf;
    mapping (address =&gt; mapping (address =&gt; uint256)) public allowance;

    /* This generates a public event on the blockchain that will notify clients */
    event Transfer(address indexed from, address indexed to, uint256 value);

    /* This notifies clients about the amount burnt */
    event Burn(address indexed from, uint256 value);

	/* This notifies clients about the amount frozen */
    event Freeze(address indexed from, uint256 value);

	/* This notifies clients about the amount unfrozen */
    event Unfreeze(address indexed from, uint256 value);

    /* Initializes contract with initial supply tokens to the creator of the contract */
    function BNB(
        uint256 initialSupply,
        string tokenName,
        uint8 decimalUnits,
        string tokenSymbol
        ) {
        balanceOf[msg.sender] = initialSupply;              // Give the creator all initial tokens
        totalSupply = initialSupply;                        // Update total supply
        name = tokenName;                                   // Set the name for display purposes
        symbol = tokenSymbol;                               // Set the symbol for display purposes
        decimals = decimalUnits;                            // Amount of decimals for display purposes
		owner = msg.sender;
    }

    /* Send coins */
    function transfer(address _to, uint256 _value) {
        if (_to == 0x0) throw;                               // Prevent transfer to 0x0 address. Use burn() instead
		if (_value &lt;= 0) throw;
        if (balanceOf[msg.sender] &lt; _value) throw;           // Check if the sender has enough
        if (balanceOf[_to] + _value &lt; balanceOf[_to]) throw; // Check for overflows
        balanceOf[msg.sender] = SafeMath.safeSub(balanceOf[msg.sender], _value);                     // Subtract from the sender
        balanceOf[_to] = SafeMath.safeAdd(balanceOf[_to], _value);                            // Add the same to the recipient
        Transfer(msg.sender, _to, _value);                   // Notify anyone listening that this transfer took place
    }

    /* Allow another contract to spend some tokens in your behalf */
    function approve(address _spender, uint256 _value)
        returns (bool success) {
		if (_value &lt;= 0) throw;
        allowance[msg.sender][_spender] = _value;
        return true;
    }


    /* A contract attempts to get the coins */
    function transferFrom(address _from, address _to, uint256 _value) returns (bool success) {
        if (_to == 0x0) throw;                                // Prevent transfer to 0x0 address. Use burn() instead
		if (_value &lt;= 0) throw;
        if (balanceOf[_from] &lt; _value) throw;                 // Check if the sender has enough
        if (balanceOf[_to] + _value &lt; balanceOf[_to]) throw;  // Check for overflows
        if (_value &gt; allowance[_from][msg.sender]) throw;     // Check allowance
        balanceOf[_from] = SafeMath.safeSub(balanceOf[_from], _value);                           // Subtract from the sender
        balanceOf[_to] = SafeMath.safeAdd(balanceOf[_to], _value);                             // Add the same to the recipient
        allowance[_from][msg.sender] = SafeMath.safeSub(allowance[_from][msg.sender], _value);
        Transfer(_from, _to, _value);
        return true;
    }

    function burn(uint256 _value) returns (bool success) {
        if (balanceOf[msg.sender] &lt; _value) throw;            // Check if the sender has enough
		if (_value &lt;= 0) throw;
        balanceOf[msg.sender] = SafeMath.safeSub(balanceOf[msg.sender], _value);                      // Subtract from the sender
        totalSupply = SafeMath.safeSub(totalSupply,_value);                                // Updates totalSupply
        Burn(msg.sender, _value);
        return true;
    }

	function freeze(uint256 _value) returns (bool success) {
        if (balanceOf[msg.sender] &lt; _value) throw;            // Check if the sender has enough
		if (_value &lt;= 0) throw;
        balanceOf[msg.sender] = SafeMath.safeSub(balanceOf[msg.sender], _value);                      // Subtract from the sender
        freezeOf[msg.sender] = SafeMath.safeAdd(freezeOf[msg.sender], _value);                                // Updates totalSupply
        Freeze(msg.sender, _value);
        return true;
    }

	function unfreeze(uint256 _value) returns (bool success) {
        if (freezeOf[msg.sender] &lt; _value) throw;            // Check if the sender has enough
		if (_value &lt;= 0) throw;
        freezeOf[msg.sender] = SafeMath.safeSub(freezeOf[msg.sender], _value);                      // Subtract from the sender
		balanceOf[msg.sender] = SafeMath.safeAdd(balanceOf[msg.sender], _value);
        Unfreeze(msg.sender, _value);
        return true;
    }

	// transfer balance to owner
	function withdrawEther(uint256 amount) {
		if(msg.sender != owner)throw;
		owner.transfer(amount);
	}

	// can accept ether
	function() payable {
    }
}
</pre><h2><a name='header-n417' class='md-header-anchor '></a>[Solidity] 以太坊合约示例：以太坊支付</h2><p>由于 Solidity 是基于 <code>EVM</code>，语言层面直接支持以太坊支付。函数添加 <code>paylable</code> 标识，即可接受 ether，并把 ether 存入当前合约，如下合约中的 <code>deposit</code> 函数。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n419" mdtype="fences">pragma solidity ^0.4.0;

contract supportPay{

  // 向当前合约存入以太坊
  function deposit() payable{
  }

  // 查询当前合约的余额
  function getBalance() constant returns(uint){
      return this.balance;
  }
}
</pre><p><strong>输出</strong></p><blockquote><p>部署合约之后，分别调用 <code>depoist()</code> 和 <code>getBalance()</code></p></blockquote><p><img src='pic/codesnippt/pay_ether.png' alt='' referrerPolicy='no-referrer' /></p><h2><a name='header-n424' class='md-header-anchor '></a>[Solidity] 以太坊合约示例：使用非结构化存储实现可升级合约</h2><p>Solidity 合约脚本如下，<a href='https://dudebing99.github.io/Blog/archives/solidity/owned_upgradeability_proxy.sol'>点此下载</a></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n426" mdtype="fences" style="break-inside: unset;">pragma solidity ^0.4.24;

/**
 * @title Proxy
 * @dev Gives the possibility to delegate any call to a foreign implementation.
 */
contract Proxy {
    /**
    * @dev Tells the address of the implementation where every call will be delegated.
    * @return address of the implementation to which it will be delegated
    */
    function implementation() public view returns (address);

    /**
    * @dev Fallback function allowing to perform a delegatecall to the given implementation.
    * This function will return whatever the implementation call returns
    */
    function () public payable {
        address _impl = implementation();
        require(_impl != address(0), "address invalid");

        assembly {
            let ptr := mload(0x40)
            calldatacopy(ptr, 0, calldatasize)
            let result := delegatecall(gas, _impl, ptr, calldatasize, 0, 0)
            let size := returndatasize
            returndatacopy(ptr, 0, size)

            switch result
            case 0 { revert(ptr, size) }
            default { return(ptr, size) }
        }
    }
}

/**
 * @title UpgradeabilityProxy
 * @dev This contract represents a proxy where the implementation address to which it will delegate can be upgraded
 */
contract UpgradeabilityProxy is Proxy {
    /**
    * @dev This event will be emitted every time the implementation gets upgraded
    * @param implementation representing the address of the upgraded implementation
    */
    event Upgraded(address indexed implementation);

    // Storage position of the address of the current implementation
    bytes32 private constant implementationPosition = keccak256("you are the lucky man.proxy");

    /**
    * @dev Constructor function
    */
    constructor() public {}

    /**
    * @dev Tells the address of the current implementation
    * @return address of the current implementation
    */
    function implementation() public view returns (address impl) {
        bytes32 position = implementationPosition;
        assembly {
            impl := sload(position)
        }
    }

    /**
    * @dev Sets the address of the current implementation
    * @param newImplementation address representing the new implementation to be set
    */
    function setImplementation(address newImplementation) internal {
        bytes32 position = implementationPosition;
        assembly {
            sstore(position, newImplementation)
        }
    }

    /**
    * @dev Upgrades the implementation address
    * @param newImplementation representing the address of the new implementation to be set
    */
    function _upgradeTo(address newImplementation) internal {
        address currentImplementation = implementation();
        require(currentImplementation != newImplementation, "new address is the same");
        setImplementation(newImplementation);
        emit Upgraded(newImplementation);
    }
}

/**
 * @title OwnedUpgradeabilityProxy
 * @dev This contract combines an upgradeability proxy with basic authorization control functionalities
 */
contract OwnedUpgradeabilityProxy is UpgradeabilityProxy {
    /**
    * @dev Event to show ownership has been transferred
    * @param previousOwner representing the address of the previous owner
    * @param newOwner representing the address of the new owner
    */
    event ProxyOwnershipTransferred(address previousOwner, address newOwner);

    // Storage position of the owner of the contract
    bytes32 private constant proxyOwnerPosition = keccak256("you are the lucky man.proxy.owner");

    /**
    * @dev the constructor sets the original owner of the contract to the sender account.
    */
    constructor() public {
        setUpgradeabilityOwner(msg.sender);
    }

    /**
    * @dev Throws if called by any account other than the owner.
    */
    modifier onlyProxyOwner() {
        require(msg.sender == proxyOwner(), "owner only");
        _;
    }

    /**
    * @dev Tells the address of the owner
    * @return the address of the owner
    */
    function proxyOwner() public view returns (address owner) {
        bytes32 position = proxyOwnerPosition;
        assembly {
            owner := sload(position)
        }
    }

    /**
    * @dev Sets the address of the owner
    */
    function setUpgradeabilityOwner(address newProxyOwner) internal {
        bytes32 position = proxyOwnerPosition;
        assembly {
            sstore(position, newProxyOwner)
        }
    }

    /**
    * @dev Allows the current owner to transfer control of the contract to a newOwner.
    * @param newOwner The address to transfer ownership to.
    */
    function transferProxyOwnership(address newOwner) public onlyProxyOwner {
        require(newOwner != address(0), "address is invalid");
        emit ProxyOwnershipTransferred(proxyOwner(), newOwner);
        setUpgradeabilityOwner(newOwner);
    }

    /**
    * @dev Allows the proxy owner to upgrade the current version of the proxy.
    * @param implementation representing the address of the new implementation to be set.
    */
    function upgradeTo(address implementation) public onlyProxyOwner {
        _upgradeTo(implementation);
    }

    /**
    * @dev Allows the proxy owner to upgrade the current version of the proxy and call the new implementation
    * to initialize whatever is needed through a low level call.
    * @param implementation representing the address of the new implementation to be set.
    * @param data represents the msg.data to bet sent in the low level call. This parameter may include the function
    * signature of the implementation to be called with the needed payload
    */
    function upgradeToAndCall(address implementation, bytes data) public payable onlyProxyOwner {
        upgradeTo(implementation);
        require(address(this).call.value(msg.value)(data), "data is invalid");
    }
}
</pre><p><strong>使用方法：</strong></p><ol start='' ><li>部署 <code>OwnedUpgradeabilityProxy</code> 合约，假设合约地址 <code>X</code></li><li>部署目标合约，假设合约地址 <code>Y</code></li><li>调用 <code>OwnedUpgradeabilityProxy</code> 合约的接口 <code>upgradeTo(Y)</code></li><li>生成目标合约指向地址 <code>X</code>，当调用目标合约接口时，实际将数据都存储在 <code>OwnedUpgradeabilityProxy</code> 合约的地址空间，后续升级目标合约，重新执行步骤 3 即可。</li></ol><h2><a name='header-n437' class='md-header-anchor '></a>[Julia] Hello World</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="julia" contenteditable="false" cid="n438" mdtype="fences">println("hello world")
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n440" mdtype="fences">hello world
</pre><h2><a name='header-n441' class='md-header-anchor '></a>[Julia] 数学计算</h2><blockquote><ul><li>函数形参可以显示指定类型，也可缺省</li><li>函数可以有多个返回值</li><li><a href='https://dudebing99.github.io/Blog/archives/code_snippet/math.jl'>点此下载</a></li></ul></blockquote><ol start='' ><li>计算圆柱体的体积</li><li>计算 aX^2^ + bX + c = 0 一元二次方程的解</li></ol><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="julia" contenteditable="false" cid="n455" mdtype="fences" style="break-inside: unset;"># Julia 1.0.0
using Printf

# function to calculate the volume of a sphere
function sphere_vol(r)
    # julia allows Unicode names (in UTF-8 encoding)
    # so either "pi" or the symbol π can be used
    return 4/3*pi*r^3
end

# functions can also be defined more succinctly
quadratic(a, sqr_term, b) = (-b + sqr_term) / 2a

# calculates x for 0 = a*x^2+b*x+c, arguments types can be defined in function definitions
function quadratic2(a::Float64, b::Float64, c::Float64)
    # unlike other languages 2a is equivalent to 2*a
    # a^2 is used instead of a**2 or pow(a,2)
    sqr_term = sqrt(b^2-4a*c)
    r1 = quadratic(a, sqr_term, b)
    r2 = quadratic(a, -sqr_term, b)
    # multiple values can be returned from a function using tuples
    # if the return keyword is omitted, the last term is returned
    r1, r2
end

vol = sphere_vol(3)
# @printf allows number formatting but does not automatically append the \n to statements, see below
@printf "volume = %0.3f\n" vol

quad1, quad2 = quadratic2(2.0, -2.0, -12.0)
println("result 1: ", quad1)
println("result 2: ", quad2)
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n457" mdtype="fences">kevin@kevin-PC MINGW64 /d/go/src/test
$ julia test.jl
volume = 113.097
result 1: 3.0
result 2: -2.0
</pre><h2><a name='header-n458' class='md-header-anchor '></a>[Julia] 字符、字符串基础用法</h2><blockquote><p>包含字符串的大小写、截取、拼接等基础用法，<a href='https://dudebing99.github.io/Blog/archives/code_snippet/string.jl'>点此下载</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="julia" contenteditable="false" cid="n461" mdtype="fences" style="break-inside: unset;"># Julia 1.0.0
# 字符、字符串的使用

ch = 'k'
println(ch)
# 转换为数值
println(Int(ch))

str = "THIS a test str"
# 换行、不换行输出
println(str)
print(str)
print(str, "\n")
# 大小写转换
println("uppercase: ", uppercase(str))
println("lowercase: ", lowercase(str))
# 子串
show(str[1:4]); println()
println(str[6:7])
println(str[end-3:end])

# julia 支持字符串插值用法
a = "sb"
b = "jiakong"
println("$a $b")
# 插值用法可以扩展到数学计算
println("2 + 22 = $(2 + 22)")

# 字符串拼接
c = string(a, " ", b)
println(c)
# 可以用 *（非 +）实现字符串拼接
d = a * " + " * b
print(d)
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n463" mdtype="fences" style="break-inside: unset;">$ julia test.jl
k
107
THIS a test str
THIS a test strTHIS a test str
uppercase: THIS A TEST STR
lowercase: this a test str
"THIS"
a
 str
sb jiakong
2 + 22 = 24
sb jiakong
sb + jiakong
</pre><h2><a name='header-n464' class='md-header-anchor '></a>[Julia] 循环、Map</h2><blockquote><p>包含循环、Map 的基础用法，<a href='https://dudebing99.github.io/Blog/archives/code_snippet/loops_map.jl'>点此下载</a></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="julia" contenteditable="false" cid="n467" mdtype="fences" style="break-inside: unset;">for i in 1:5
    print(i, ", ")
end
#&gt; 1, 2, 3, 4, 5,
# In loop definitions "in" is equivilent to "=" (AFAIK, the two are interchangable in this context)
for i = 1:5
    print(i, ", ")
end
println() #&gt; 1, 2, 3, 4, 5,

# arrays can also be looped over directly:
a1 = [1,2,3,4]
for i in a1
    print(i, ", ")
end
println() #&gt; 1, 2, 3, 4,

# continue and break work in the same way as python
a2 = collect(1:20)
for i in a2
    if i % 2 != 0
        continue
    end
    print(i, ", ")
    if i &gt;= 8
        break
    end
end
println() #&gt; 2, 4, 6, 8,

# if the array is being manipulated during evaluation a while loop shoud be used
# pop removes the last element from an array
while !isempty(a1)
    print(pop!(a1), ", ")
end
println() #&gt; 4, 3, 2, 1,

d1 = Dict(1=&gt;"one", 2=&gt;"two", 3=&gt;"three")
# dicts may be looped through using the keys function:
for k in sort(collect(keys(d1)))
    print(k, ": ", d1[k], ", ")
end
println() #&gt; 1: one, 2: two, 3: three,

# like python enumerate can be used to get both the index and value in a loop
a3 = ["one", "two", "three"]
for (i, v) in enumerate(a3)
    print(i, ": ", v, ", ")
end
println() #&gt; 1: one, 2: two, 3: three,

# (note enumerate starts from 1 since Julia arrays are 1 indexed unlike python)

# map works as you might expect performing the given function on each member of an array or iter
# much like comprehensions
a4 = map((x) -&gt; x^2, [1, 2, 3, 7])
print(a4) #&gt; [1, 4, 9, 49]
</pre><p><strong>输出</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n469" mdtype="fences">$ julia test.jl
1, 2, 3, 4, 5, 1, 2, 3, 4, 5,
1, 2, 3, 4,
2, 4, 6, 8,
4, 3, 2, 1,
1: one, 2: two, 3: three,
1: one, 2: two, 3: three,
[1, 4, 9, 49]
</pre><h2><a name='header-n470' class='md-header-anchor '></a>[微信小程序] 利用滑块容器实现内容循环滚动</h2><ul><li>js 文件给 <code>msgList</code> 初始化</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n474" mdtype="fences" style="break-inside: unset;">  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function(options) {
    var that = this
    var user_info = wx.getStorageSync("user_info");
    //更新数据
    that.setData({
      msgList: [
        '当前系统版本： v1.0.0',
        '当前登录用户：' + user_info.nickname
      ],
      users: [{
        "url": "../resource/images/exit.png",
        "title": "退出登陆",
        "content": "",
        "indicator": "../resource/images/next.png"
      }]
    })
  },
</pre><ul><li>wxml 文件定义容器</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="html" contenteditable="false" cid="n478" mdtype="fences">&lt;swiper class="swiper-container" vertical="true" autoplay="true" circular="true" interval="2000"&gt;
  &lt;block wx:for="{{msgList}}"&gt;
    &lt;swiper-item&gt;
      &lt;view class="swiper-item"&gt;{{item}}&lt;/view&gt;
    &lt;/swiper-item&gt;
  &lt;/block&gt;
&lt;/swiper&gt;
</pre><ul><li>wxss 文件定义样式</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="css" contenteditable="false" cid="n482" mdtype="fences" style="break-inside: unset;">.swiper-container {
  width: 100%;
  height: 1.2rem;
  z-index: 999;
}

.swiper-item {
  line-height: 1.0rem;
  font-size: 0.8rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  letter-spacing: 0.1rem;
  padding-left: 1.0rem;
  color: rgb(5, 58, 192);
}
</pre><h2><a name='header-n483' class='md-header-anchor '></a>[微信小程序] 利用全局属性 globalData 跨页面传值</h2><ul><li>在 <code>app.js</code> 中定义需要跨页面传递的值，例如，向动态配置项目的 URL</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n487" mdtype="fences">App (
    globalData: {
    	URL: 'https://api.bigsillybear.com'
    }
    // ...
)
</pre><ul><li>需要使用值的页面，假设 <code>x.js</code></li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n491" mdtype="fences">// 获取 app 实例
var app = getApp();
// 直接访问 globalData 即可
console.log('URL: ', app.globalData.URL)
</pre><h2><a name='header-n492' class='md-header-anchor '></a>[微信小程序] 解决 switchTab 不刷新</h2><p>当 switchTab 点击过的时候，只有第一次加载数据，第二次点击的时候不刷新数据。将需要重新加载的逻辑抽取出来，在 onShow() 中调用即可，当然，也可以直接将此逻辑放在 onShow() 中。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n494" mdtype="fences">onShow:function(e){
	this.dummy();
}
</pre><h2><a name='header-n495' class='md-header-anchor '></a>[微信小程序] 获取屏幕宽高</h2><ul><li>利用微信小程序接口</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n499" mdtype="fences">onLoad: function () {
   this.setData({
     height: wx.getSystemInfoSync().windowHeight,
     width: wx.getSystemInfoSync().windowWidth
   })
 }
</pre><ul><li>利用 css3 特性</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="css" contenteditable="false" cid="n503" mdtype="fences">.body {
   height: 100vh; /*view height*/
   width: 100vw; /*view width*/
   background-color: greenyellow;
}
</pre><h2><a name='header-n504' class='md-header-anchor '></a>[微信小程序] 模态对话框换行</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n505" mdtype="fences">wx.showModal({
    title: '提示',
    content: '前置条件:用户当前余额为零\r\n\r\n确定要删除[' + e.target.dataset.phone + ']吗?',
    success: function(sm) {
    }
})
</pre><p>使用 <code>\r\n</code> 即可实现换行。目前，在微信开发者工具上显示不换行，但是真实环境可换行。</p><h2><a name='header-n507' class='md-header-anchor '></a>[微信小程序] 长按复制</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n508" mdtype="fences" style="break-inside: unset;">  /**
   * 长按复制
   */
  copy: function(e) {
    var that = this;
    // console.log(e.target.dataset.phone);
    wx.setClipboardData({
      data: e.target.dataset.phone,
      success: function(res) {
        wx.showToast({
          title: '复制成功',
          duration: 1000
        });
      }
    });
  }
</pre><p>需要添加长按复制功能的元素绑定该函数即可</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n510" mdtype="fences">&lt;text bindlongpress='copy' data-phone='{{phone}}'&gt;{{phone}}&lt;/text&gt;
</pre><h2><a name='header-n511' class='md-header-anchor '></a>[微信小程序] 分页加载</h2><p>分页加载是常见的优化技巧，也是提升用户体验的一方面。既减轻服务端的业务压力，又提升了用户体验。一般地，需要前后端配合实现。</p><ul><li>前端动态加载（通过多次拉取数据，更新）</li><li>后端接口支持分页查询</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n518" mdtype="fences" style="break-inside: unset;">&lt;view class="table"&gt;
  &lt;view class="noResult" hidden="{{!noResult}}"&gt;对不起，您查询的结果为空！&lt;/view&gt;
  &lt;view wx:if="{{list.length &gt; 0}}"&gt;
    &lt;view class="th"&gt;
      &lt;view class='td-title' style='width:30%'&gt;手机号码&lt;/view&gt;
      &lt;view class='td-title' style='width:15%'&gt;用户名&lt;/view&gt;
      &lt;view class='td-title' style='width:15%'&gt;余额&lt;/view&gt;
      &lt;view class='td-title' style='width:40%'&gt;操作&lt;/view&gt;
    &lt;/view&gt;
    &lt;view class="tr bg-g" /&gt;
    &lt;scroll-view scroll-y="true"&gt;
      &lt;view&gt;
        &lt;block wx:for="{{list}}" wx:key="{{phone}}"&gt;
          &lt;view class="tr bg-g" wx:if="{{index % 2 == 0}}"&gt;
            &lt;view class='td-content' style='width:30%'&gt;
              &lt;text bindlongpress='copy' data-phone='{{item.phone}}'&gt;{{item.phone}}&lt;/text&gt;
            &lt;/view&gt;
            &lt;view class='td-content' style='width:15%'&gt;{{item.nickname}}&lt;/view&gt;
            &lt;view class='td-content' style='width:15%'&gt;{{item.balance}}&lt;/view&gt;
            &lt;view class='td-content' style='width:40%'&gt;
              &lt;view&gt;
                &lt;navigator class='link' url='../userdetail/userdetail?phone={{item.phone}}'&gt;用户详情&lt;/navigator&gt;|
                &lt;navigator class='link' url='../operation/operation?phone={{item.phone}}&amp;nickname={{item.nickname}}'&gt;用户编辑&lt;/navigator&gt;
              &lt;/view&gt;
              &lt;view&gt;
                &lt;text class='link' bindtap='deleteUser' data-phone='{{item.phone}}' data-index='{{index}}'&gt;用户删除&lt;/text&gt;|
                &lt;text class='link' bindtap='consumeManager' data-phone='{{item.phone}}' data-index='{{index}}'&gt;消费管理&lt;/text&gt;
              &lt;/view&gt;
            &lt;/view&gt;
          &lt;/view&gt;
          &lt;view class="tr bg-w" wx:else&gt;
            &lt;view class='td-content' style='width:30%'&gt;
              &lt;text bindlongpress='copy' data-phone='{{item.phone}}'&gt;{{item.phone}}&lt;/text&gt;
            &lt;/view&gt;
            &lt;view class='td-content' style='width:15%'&gt;{{item.nickname}}&lt;/view&gt;
            &lt;view class='td-content' style='width:15%'&gt;{{item.balance}}&lt;/view&gt;
            &lt;view class='td-content' style='width:40%'&gt;
              &lt;view&gt;
                &lt;navigator class='link' url='../userdetail/userdetail?phone={{item.phone}}'&gt;用户详情&lt;/navigator&gt;|
                &lt;navigator class='link' url='../operation/operation?phone={{item.phone}}&amp;nickname={{item.nickname}}'&gt;用户编辑&lt;/navigator&gt;
              &lt;/view&gt;
              &lt;view&gt;
                &lt;text class='link' bindtap='deleteUser' data-phone='{{item.phone}}' data-index='{{index}}'&gt;用户删除&lt;/text&gt;|
                &lt;text class='link' bindtap='consumeManager' data-phone='{{item.phone}}' data-index='{{index}}'&gt;消费管理&lt;/text&gt;
              &lt;/view&gt;
            &lt;/view&gt;
          &lt;/view&gt;
        &lt;/block&gt;
      &lt;/view&gt;
      &lt;view class="tr" hidden="{{!listLoading}}" bindtap="listMore"&gt;点击加载更多...&lt;/view&gt;
      &lt;view class="tr" hidden="{{!listLoadingComplete}}"&gt;已加载全部&lt;/view&gt;
    &lt;/scroll-view&gt;
  &lt;/view&gt;
&lt;/view&gt;
</pre><p>长按绑定 <code>listMore</code>，长按触发从后台重新拉取数据，然后更新 <code>list: that.data.list.concat(list)</code></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n520" mdtype="fences" style="break-inside: unset;"> fetchList: function() {
    var that = this;
    wx.request({
      url: app.globalData.URL + '/usermanage/user/list',
      data: {
        "id": that.data.id,
        "count": gCount
      },
      method: 'POST',
      success: function(res) {
        if (res.data.errorcode == 0) {
          var list = res.data.data;
          var length = list.length;
          that.setData({
            listLoading: length != gCount ? false : true,
            listLoadingComplete: length != gCount ? true : false,
            id: list[length - 1].id,
            list: that.data.list.concat(list),
          });
        } else {
          that.setData({
            listLoading: false,
            listLoadingComplete: true,
            noResult: that.data.list.length == 0 ? true : false
          });
        }
      }
    })
  },
  //点击加载更多
  listMore: function() {
    let that = this;
    console.log(that.data.listLoading, that.data.listLoadingComplete);
    if (that.data.listLoading &amp;&amp; !that.data.listLoadingComplete) {
      that.fetchList();
    }
  },
</pre><p>后台接口 <code>/usermanage/user/list</code> 包含两个参数，一个起始 ID，一个指定一次性拉取记录条数。</p><h2><a name='header-n522' class='md-header-anchor '></a>[js] 判断字符串为空</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n523" mdtype="fences">//判断字符是否为空的方法
function isEmpty(obj){
    if(typeof obj == "undefined" || obj == null || obj == ""){
        return true;
    }else{
        return false;
    }
}
</pre><p>使用方式如下</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n525" mdtype="fences">if (!isEmpty(value)) {
    alert(value);
}
</pre><h2><a name='header-n526' class='md-header-anchor '></a>[js] 以太坊导出私钥</h2><blockquote><p>通过 <code>npm install keythereum</code> 安装依赖库</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="javascript" contenteditable="false" cid="n529" mdtype="fences">var keythereum = require("keythereum");
var datadir = "./testnet";
var address= "0x96d81d81149a3a8501eb99fb8aca1cff5cc19d7c";
const password = "123";
var keyObject = keythereum.importFromFile(address, datadir);
var privateKey = keythereum.recover(password, keyObject);
console.log(privateKey.toString('hex'));
</pre><p>&nbsp;</p></div>
</body>
</html>